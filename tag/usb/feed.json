{
    "version": "https://jsonfeed.org/version/1",
    "title": "Oikiou's Blog • All posts by \"usb\" tag",
    "description": "Blog",
    "home_page_url": "https://www.oikiou.top",
    "items": [
        {
            "id": "https://www.oikiou.top/2023/9c721b62/",
            "url": "https://www.oikiou.top/2023/9c721b62/",
            "title": "USB",
            "date_published": "2023-12-01T10:12:15.000Z",
            "content_html": "<h1 id=\"USB-版本及发展历史\"><a href=\"#USB-版本及发展历史\" class=\"headerlink\" title=\"USB 版本及发展历史\"></a>USB 版本及发展历史</h1><p>USB接口自1994年推出以来，经过26年的发展，经过USB1.0&#x2F;1.1、USB2.0、USB3.x，最终发展到了现在的USB4；传输速率也从最开始的1.5Mbps，大幅提高到了最新的40Gbps。<br><img src=\"/2023/9c721b62/image-20240621114302408.png\"></p>\n<h2 id=\"USB1-0\"><a href=\"#USB1-0\" class=\"headerlink\" title=\"USB1.0\"></a>USB1.0</h2><ul>\n<li>1996年1月15日推出USB1.0接口规范</li>\n<li>规定低速传输速率为1.5Mbit&#x2F;s</li>\n<li>对外提供供电电压为5V，最大电流500mA</li>\n<li>一般适用于鼠标、键盘等低速HID设备。</li>\n<li>支持热插拨</li>\n</ul>\n<h2 id=\"USB1-1\"><a href=\"#USB1-1\" class=\"headerlink\" title=\"USB1.1\"></a>USB1.1</h2><ul>\n<li>1998年9月23日对原来的USB1.0进行升级，提出了USB1.1</li>\n<li>USB1.1规定了全速传输速率为12Mbit&#x2F;s,并兼容USB1.0的1.5Mbit&#x2F;s</li>\n<li>传输线缆最大度度3m</li>\n<li>对外提供供电电压为5V，最大电流500mA</li>\n<li>一般适用于鼠标、键盘、U盘，光驱等。</li>\n<li>一个USB接口理论上可以支持127个设备。</li>\n</ul>\n<h2 id=\"USB2-0\"><a href=\"#USB2-0\" class=\"headerlink\" title=\"USB2.0\"></a>USB2.0</h2><ul>\n<li>2000年4月27日由USB-IF组织提出了USB2.0总线协议规范</li>\n<li>具备480Mbit&#x2F;s的高速传输速率，向下兼容低速1.5Mbit&#x2F;s和全速12Mit&#x2F;s</li>\n<li>传输线缆最大度度5m</li>\n<li>对外提供供电电压为5V，最大电流500mA</li>\n<li>通过HUB级联的方式，一个USB接口理论上可以扩展127个USB设备</li>\n<li>支持 4种传输方式：控制传输、中断传输、同步传输和块传输。</li>\n</ul>\n<p><strong>USB3 的名字有些多</strong></p>\n<table>\n<thead>\n<tr>\n<th>版本</th>\n<th>时间</th>\n<th>带宽</th>\n<th>别名，指的是同一种</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>USB3.0</td>\n<td>2008年11月17</td>\n<td>5Gbps</td>\n<td>SuperSpeed USB、USB 3.2 Gen 1、USB 3.1 Gen 1</td>\n</tr>\n<tr>\n<td>USB3.1</td>\n<td>2013年7月</td>\n<td>10Gbps</td>\n<td>SuperSpeed USB 10Gbps、USB 3.2 Gen 2、USB 3.1 Gen 2</td>\n</tr>\n<tr>\n<td>USB3.2</td>\n<td>2017年9月份</td>\n<td>20Gbps</td>\n<td>SuperSpeed USB 20Gbps、USB 3.2 Gen 2x2</td>\n</tr>\n</tbody></table>\n<h2 id=\"USB3-0-USB-3-2-Gen-1-USB-3-1-Gen-1\"><a href=\"#USB3-0-USB-3-2-Gen-1-USB-3-1-Gen-1\" class=\"headerlink\" title=\"USB3.0 &#x2F; USB 3.2 Gen 1 &#x2F; USB 3.1 Gen 1\"></a>USB3.0 &#x2F; USB 3.2 Gen 1 &#x2F; USB 3.1 Gen 1</h2><ul>\n<li>超高速USB3.0规范于2008年11月17日出USB-IF组织推出。</li>\n<li>提供更高的5.0Gbit&#x2F;s的超高速传输速度，并向下兼容低速1.5Mbits&#x2F;s、全速12Mbit&#x2F;s和高速480Mbit&#x2F;s传输速率</li>\n<li>对外提供供电电压为5V，最大电流900mA</li>\n<li>传输线缆最大度度3m</li>\n<li>增加了新的电源管理功能，支持待机、睡眠以及暂定模式，更加省电。</li>\n<li>全双工通讯。</li>\n</ul>\n<h2 id=\"USB3-1-USB-3-2-Gen-2-USB-3-1-Gen-2\"><a href=\"#USB3-1-USB-3-2-Gen-2-USB-3-1-Gen-2\" class=\"headerlink\" title=\"USB3.1 &#x2F; USB 3.2 Gen 2 &#x2F; USB 3.1 Gen 2\"></a>USB3.1 &#x2F; USB 3.2 Gen 2 &#x2F; USB 3.1 Gen 2</h2><p>2013年7月份，USB 3.1发布，速度翻番至10Gbps，同时USB-IF就把USB 3.0改名为USB 3.1 Gen 1，新的USB 3.1则叫做USB 3.1 Gen 2。</p>\n<ul>\n<li>2013年7月份发布</li>\n<li>速度翻番至10Gbps</li>\n<li>新增USB A&#x2F;V影音传输。以更适合作为移动设备的输出接口，尤其是可逆的Type-C。</li>\n<li>将供电的最高允许标准提高到了20V&#x2F;5A，供电100W。</li>\n<li>必须使用USB Type-C接口才能达到10Gbps的速度。</li>\n</ul>\n<h2 id=\"USB3-2-USB-3-2-Gen-2x2\"><a href=\"#USB3-2-USB-3-2-Gen-2x2\" class=\"headerlink\" title=\"USB3.2 &#x2F; USB 3.2 Gen 2x2\"></a>USB3.2 &#x2F; USB 3.2 Gen 2x2</h2><ul>\n<li>2017年9月份，USB 3.2发布。</li>\n<li>据最新公布的规范，USB 3.0、USB 3.1的版本命名都将彻底消失，统一被划入USB 3.2的序列，三者分别再次改名叫做USB 3.2 Gen 1、USB 3.2 Gen 2、USB 3.2 Gen 2x2。</li>\n<li>它们还各自有一个市场推广命名，分别是SuperSpeed USB、SuperSpeed USB 10Gbps、SuperSpeed USB 20Gbps。<br>  之所以想出USB 3.2 Gen2x2这样的名字，大概是因为它使用了USB Type-C接口的上下两端全部针脚，速度得以翻番。</li>\n<li>必须使用USB Type-C接口才能达到20Gbps的速度。</li>\n</ul>\n<h1 id=\"USB-描述符\"><a href=\"#USB-描述符\" class=\"headerlink\" title=\"USB 描述符\"></a>USB 描述符</h1><blockquote>\n<p>  USB是个通用的总线，端口都是统一的。但是USB设备却各种各样，例如USB鼠标，USB键盘，U盘等等，那么USB主机是如何识别出不同的设备的呢？这就要依赖于描述符了。</p>\n<p>  USB的描述符主要有<strong>设备描述符，配置描述符，接口描述符，端点描述符，字符串描述符，HID描述符，报告描述符</strong>等等。</p>\n</blockquote>\n<p><strong>USB各个描述符之间的关系</strong></p>\n<blockquote>\n<p>  一个USB设备有一个<strong>设备描述符</strong>，设备描述符里面决定了该设备有<strong>多少种配置</strong>，每种配置描述符对应着配置描述符；</p>\n<p>  而在<strong>配置描述符</strong>中又定义了该配置里面有<strong>多少个接口</strong>，每个接口有对应的接口描述符；</p>\n<p>  在<strong>接口描述符</strong>里面又定义了该接口有<strong>多少个端点</strong>，每个端点对应一个端点描述符；</p>\n<p>  在<strong>端点描述符</strong>定义了端点的大小，类型等等。</p>\n<blockquote>\n<p>  由此我们可以看出，USB的描述符之间的关系是一层一层的，最上一层是设备描述符，下面是配置描述符，再下面是接口描述符，再下面是端点描述符。</p>\n<p>  在获取描述符时，先获取设备描述符，然后再获取配置描述符，根据配置描述符中的配置集合长度，一次将配置描述符、接口描述符、端点描述符一起一次读回。</p>\n<p>  其中可能还会有获取设备序列号，厂商字符串，产品字符串等。</p>\n</blockquote>\n</blockquote>\n<p><strong>各个描述符的编号</strong></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs c\"><span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> DEVICE_DESCRIPTOR               0x01  <span class=\"hljs-comment\">//设备描述符   </span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> CONFIGURATION_DESCRIPTOR        0x02  <span class=\"hljs-comment\">//配置描述符   </span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> STRING_DESCRIPTOR               0x03  <span class=\"hljs-comment\">//字符串描述符   </span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> INTERFACE_DESCRIPTOR            0x04  <span class=\"hljs-comment\">//接口描述符   </span></span><br><span class=\"hljs-meta\">#<span class=\"hljs-keyword\">define</span> ENDPOINT_DESCRIPTOR             0x05  <span class=\"hljs-comment\">//端点描述符  </span></span><br></code></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/2023/9c721b62/v2-43379ad330f4acd76ce885f2e1359458_720w.webp\" alt=\"img\"></p>\n<p><img src=\"/2023/9c721b62/usbdes.jpeg\" alt=\"img\"></p>\n<p><img src=\"/2023/9c721b62/image-20240620151939825.png\"></p>\n<h2 id=\"设备描述符-0x01-Device-Descriptor\"><a href=\"#设备描述符-0x01-Device-Descriptor\" class=\"headerlink\" title=\"设备描述符 0x01 Device Descriptor\"></a>设备描述符 0x01 Device Descriptor</h2><p><img src=\"/2023/9c721b62/dev.png\" alt=\"设备描述符\"></p>\n<p><strong>代码</strong></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs c\"><span class=\"hljs-comment\">// 定义标准的设备描述符结构</span><br><span class=\"hljs-keyword\">typedef</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> _<span class=\"hljs-title\">DEVICE_DCESCRIPTOR_STRUCT</span> &#123;</span><br>    BYTE blength;            <span class=\"hljs-comment\">// 设备描述符的字节数大小</span><br>    BYTE bDescriptorType;    <span class=\"hljs-comment\">// 设备描述符类型编号</span><br>    WORD bcdUSB;             <span class=\"hljs-comment\">// USB版本号</span><br>    BYTE bDeviceClass;       <span class=\"hljs-comment\">// USB分配的设备类代码</span><br>    BYTE bDeviceSubClass;    <span class=\"hljs-comment\">// USB分配的子类代码</span><br>    BYTE bDeviceProtocol;    <span class=\"hljs-comment\">// USB分配的设备协议代码</span><br>    BYTE bMaxPacketSize0;    <span class=\"hljs-comment\">// 端点0的最大包大小</span><br>    WORD idVendor;           <span class=\"hljs-comment\">// 厂商编号</span><br>    WORD idProduct;          <span class=\"hljs-comment\">// 产品编号</span><br>    WORD bcdDevice;          <span class=\"hljs-comment\">// 设备出厂编号</span><br>    BYTE iManufacturer;      <span class=\"hljs-comment\">// 设备厂商字符串的索引</span><br>    BYTE iProduct;           <span class=\"hljs-comment\">// 描述产品字符串的索引</span><br>    BYTE iSerialNumber;      <span class=\"hljs-comment\">// 描述设备序列号字符串的索引</span><br>    BYTE bNumConfigurations; <span class=\"hljs-comment\">// 可能的配置数量</span><br>&#125; DEVICE_DESCRIPTOR_STRUCT, *pDEVICE_DESCRIPTOR_STRUCT;<br><br><span class=\"hljs-comment\">// 实际的设备描述符示例</span><br>DEVICE_DESCRIPTOR_STRUCT device_descriptor = &#123;<br>.blength           =<span class=\"hljs-keyword\">sizeof</span>(DEVICE_DESCRIPTOR_STRUCT),<span class=\"hljs-comment\">// 设备描述符的字节数大小，这里是18字节</span><br>.bDescriptorType   =DEVICE_DESCRIPTOR,  <span class=\"hljs-comment\">// 设备描述符类型编号，设备描述符是01</span><br>.bcdUSB            =<span class=\"hljs-number\">0x1001</span>, <span class=\"hljs-comment\">// USB版本号，这里是USB01.10，即USB1.1。由于51是大端模式，所以高低字节交换</span><br>.bDeviceClass      =<span class=\"hljs-number\">0x00</span>,   <span class=\"hljs-comment\">// USB分配的设备类代码，0表示类型在接口描述符中定义</span><br>.bDeviceSubClass   =<span class=\"hljs-number\">0x00</span>,   <span class=\"hljs-comment\">// USB分配的子类代码，上面一项为0时，本项也要设置为0</span><br>.bDeviceProtocol   =<span class=\"hljs-number\">0x00</span>,   <span class=\"hljs-comment\">// USB分配的设备协议代码，上面一项为0时，本项也要设置为0</span><br>.bMaxPacketSize0   =<span class=\"hljs-number\">0x10</span>,   <span class=\"hljs-comment\">// 端点0的最大包大小，这里为16字节</span><br>.idVendor          =<span class=\"hljs-number\">0x7104</span>, <span class=\"hljs-comment\">// 厂商编号，这个是需要跟USB组织申请的ID号，表示厂商代号。</span><br>.idProduct         =<span class=\"hljs-number\">0xf0ff</span>, <span class=\"hljs-comment\">// 该产品的编号，跟厂商编号一起配合使用，让主机注册该设备并加载相应的驱动程序</span><br>.bcdDevice         =<span class=\"hljs-number\">0x0100</span>, <span class=\"hljs-comment\">// 设备出厂编号</span><br>.iManufacturer     =<span class=\"hljs-number\">0x01</span>,   <span class=\"hljs-comment\">// 设备厂商字符串的索引，在获取字符串描述符时，使用该索引号来识别不同的字符串</span><br>.iProduct          =<span class=\"hljs-number\">0x02</span>,   <span class=\"hljs-comment\">// 描述产品字符串的索引，同上</span><br>.iSerialNumber     =<span class=\"hljs-number\">0x03</span>,   <span class=\"hljs-comment\">// 描述设备序列号字符串的索引，同上</span><br>.bNumConfigurations=<span class=\"hljs-number\">0x01</span>    <span class=\"hljs-comment\">// 可能的配置数为1，即该设备只有一个配置</span><br>&#125;;<br></code></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li><p><strong>bLength</strong></p>\n<ul>\n<li>是设备描述符的总长度，以字节为单位。</li>\n</ul>\n</li>\n<li><p><strong>bDescriptorType</strong></p>\n<ul>\n<li>代表了本描述符的类型。</li>\n<li>用于描述设备的描述符 是0x01。<ul>\n<li>其他描述符的数值及含义</li>\n<li><img src=\"/2023/9c721b62/d976ff82852a45ea8fc59183689cbd5b.png\" alt=\"在这里插入图片描述\"></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><strong>bcdUSB</strong></p>\n<ul>\n<li>显示了设备支持的USB版本，通常是最新版本。</li>\n<li>这是一个<a href=\"https://so.csdn.net/so/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6&spm=1001.2101.3001.7020\">二进制</a>代码形式的十进制数据，采用0xAABC的形式，其中A是主版本号，B是次版本号，C是子次版本号。</li>\n<li>例如，USB2.0设备拥有0x0200值，USB1.1设备拥有0x0110值。通常，主机将使用bcdUSB以确定需要加载的USB驱动器。</li>\n</ul>\n</li>\n<li><p><strong>bDeviceClass</strong>、<strong>bDeviceSubClass</strong>、<strong>bDeviceProtocol</strong></p>\n<ul>\n<li>分别代表<strong>设备类型</strong>，<strong>子类型</strong>，<strong>设备使用的协议</strong></li>\n<li>USB-IF区分设备类分了三个等级（类-子类-协议码）其中，<ul>\n<li>类包含人机交互类、图像类、无线类、音频类等等，</li>\n<li>子类比如音频类的音频控制、音频流等等，</li>\n<li>协议比如人机接口类中的鼠标、键盘、<a href=\"https://so.csdn.net/so/search?q=%E8%A7%A6%E6%91%B8%E5%B1%8F&spm=1001.2101.3001.7020\">触摸屏</a>等，</li>\n</ul>\n</li>\n<li><blockquote>\n<p>  为何会有这么多USB的Class分类，子分类，设备协议。<br>  我们要知道，USB协议设计的目的，就是为实现通用，用单一的USB接口取代之前种类繁多的各种其他接口。而为了取代其他各种接口，那意味着就要实现各种设备所对应的各种功能。</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><p><strong>bMaxPackeSize0</strong></p>\n<ul>\n<li>端点一次最大传多少个字节。</li>\n<li>根据设备，数据包的大小可以为 8 个字节、 16 个字节、 32 个字节和 64 个字节。</li>\n<li>USB协议里有规定，端点0最低8字节，端点的最大传输大小和USB速度等级以及传输类型有关，<strong>控制传输一般使用端点0</strong>，低速最大8字节，全速和高速最大传输64字节：</li>\n</ul>\n</li>\n<li><p><strong>idVendor</strong></p>\n<ul>\n<li>代表着设备的生产商ID,由USB设备生产商向USB-IF官方来统一管理和申请。</li>\n</ul>\n</li>\n<li><p><strong>idProduct</strong></p>\n<ul>\n<li>代表着该生产商生产的产品编号，同一厂商下的不同idProduct代表着该公司不同的产品系列。</li>\n</ul>\n</li>\n<li><p><strong>bcdDevice</strong></p>\n<ul>\n<li>是一个BCD编码格式，代表着设备的出产编号，或者同一产品的版本更新迭代。</li>\n</ul>\n</li>\n<li><p><strong>iManufacturer</strong></p>\n<ul>\n<li>描述厂商的字符串的索引，为0则表示没有。</li>\n</ul>\n</li>\n<li><p><strong>iProduct</strong></p>\n<ul>\n<li>描述产品的字符串的索引，为0则表示没有。</li>\n</ul>\n</li>\n<li><p><strong>iSerialNumber</strong></p>\n<ul>\n<li>产品序列号字符串的索引，为0则表示没有。</li>\n</ul>\n</li>\n<li><p><strong>bNumConfigurations</strong></p>\n<ul>\n<li>指示设备有多少个配置，前面提到过，一个USB可能有多个配置，一般USB产品都是1个配置。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"配置描述符-0x02-Configuration-Descriptor\"><a href=\"#配置描述符-0x02-Configuration-Descriptor\" class=\"headerlink\" title=\"配置描述符 0x02 Configuration Descriptor\"></a>配置描述符 0x02 Configuration Descriptor</h2><table>\n<thead>\n<tr>\n<th>偏移</th>\n<th>字段</th>\n<th>大小<br>Byte</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>bLength</td>\n<td>1</td>\n<td>该描述符的长度 &#x3D; 9 个字节</td>\n</tr>\n<tr>\n<td>1</td>\n<td>bDescriptorType</td>\n<td>1</td>\n<td>描述符类型 &#x3D; 配置（02h）</td>\n</tr>\n<tr>\n<td>2</td>\n<td>wTotalLength</td>\n<td>2</td>\n<td>总长度包括接口和端点描述符在内</td>\n</tr>\n<tr>\n<td>4</td>\n<td>bNumInterfaces</td>\n<td>1</td>\n<td>本配置中接口的数量</td>\n</tr>\n<tr>\n<td>5</td>\n<td>bConfigurationValue</td>\n<td>1</td>\n<td>SET_CONFIGURATION 请求所使用的配置值，用于选择该配置</td>\n</tr>\n<tr>\n<td>6</td>\n<td>iConfiguration</td>\n<td>1</td>\n<td>描述该配置的字符串索引</td>\n</tr>\n<tr>\n<td>7</td>\n<td>bmAttributes</td>\n<td>1</td>\n<td>位 7：预留（设置为 1） <br>位 6：自供电 <br>位 5：远程唤醒<br>位 4:0：保留</td>\n</tr>\n<tr>\n<td>8</td>\n<td>bMaxPower</td>\n<td>1</td>\n<td>本配置所需的最大功耗（单位为 2 mA）</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p><strong>bLength</strong> 1字节，表示配置描述符的长度，配置描述符的长度是9字节。</p>\n</li>\n<li><p><strong>bDescriptor</strong> 1字节，表示描述符的类型，配置描述符的类型编码为 0x02。</p>\n</li>\n<li><p><strong>wTotalLength</strong> 2字节，是整个配置描述符集合的总长度。包括配置描述符，接口描述符，端点描述符和类特殊描述符（如果有）。</p>\n</li>\n<li><p><strong>bNumInterfaces</strong> 1字节，则定义了在该指定配置中接口总数。最小为 1 个接口，通常功能单一的设备只有一个接口（如鼠标），而复合设备具有多个接口（如音频设备）。</p>\n</li>\n<li><p><strong>bConfigurationValue</strong> 1字节，表示该配置的值，设置配置请求时会发送一个配置值，如果某个配置的bConfigurationValue和它相匹配，就表示该配置被激活。</p>\n</li>\n<li><p><strong>iConfiguration</strong> 1字节，描述该配置的字符串的索引，如果该值为0，表示没有字符串来描述它。</p>\n</li>\n<li><p><strong>bmAttributes</strong> 1字节，定义了 USB 设备的一些特性。 位7保留，必须设置为1，位6表示供电方式，设置为 0表示设备由总线供电，设置为 1 表示设备自供电。位5表示是否支持远程唤醒，设置为 1表示支持远程唤醒，设置为 0 表示不支持远程唤醒。位4~位0设置为0。</p>\n</li>\n<li><p><strong>bMaxPower</strong> 1字节，表示设备需要从总线获取的最大电流量，以 2 mA 为单位。如需要200mA的最大电流，则该字段的值为100。</p>\n</li>\n</ul>\n<h2 id=\"字符串描述符-0x03\"><a href=\"#字符串描述符-0x03\" class=\"headerlink\" title=\"字符串描述符 0x03\"></a>字符串描述符 0x03</h2><table>\n<thead>\n<tr>\n<th>偏移</th>\n<th>字段</th>\n<th>大小（字节）</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>bLength</td>\n<td>1</td>\n<td>该描述符的长度 &#x3D; 7 个字节</td>\n</tr>\n<tr>\n<td>1</td>\n<td>bDescriptorType</td>\n<td>1</td>\n<td>描述符类型 &#x3D; STRING （03h）</td>\n</tr>\n<tr>\n<td>2..n</td>\n<td>bString 或 wLangID</td>\n<td>变化</td>\n<td>Unicode 编码字符串 或 LANGID 代码</td>\n</tr>\n</tbody></table>\n<p>字符串描述符是可选的，字符串描述符用于描述一些方便人们阅读的信息，比如制造商、设备名称啥的。如果一个设备没有字符串描述符，那么其他描述符中和字符串有关的索引值都必须为 0。</p>\n<h2 id=\"接口描述符-0x04-Interface-Descriptor\"><a href=\"#接口描述符-0x04-Interface-Descriptor\" class=\"headerlink\" title=\"接口描述符 0x04 Interface Descriptor\"></a>接口描述符 0x04 Interface Descriptor</h2><table>\n<thead>\n<tr>\n<th>偏移</th>\n<th>字段</th>\n<th>大小（字节）</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>bLength</td>\n<td>1</td>\n<td>该描述符的长度 &#x3D; 9 个字节</td>\n</tr>\n<tr>\n<td>1</td>\n<td>bDescriptorType</td>\n<td>1</td>\n<td>描述符类型 &#x3D; 接口（04h）</td>\n</tr>\n<tr>\n<td>2</td>\n<td>bInterfaceNumber</td>\n<td>1</td>\n<td>该接口基于零的索引</td>\n</tr>\n<tr>\n<td>3</td>\n<td>bAlternateSetting</td>\n<td>1</td>\n<td>备用设置值</td>\n</tr>\n<tr>\n<td>4</td>\n<td>bNumEndpoints</td>\n<td>1</td>\n<td>该接口所使用的端点数量（不包含 EP0）</td>\n</tr>\n<tr>\n<td>5</td>\n<td>bInterfaceClass</td>\n<td>1</td>\n<td>接口类别</td>\n</tr>\n<tr>\n<td>6</td>\n<td>bInterfaceSubclass</td>\n<td>1</td>\n<td>接口子类别</td>\n</tr>\n<tr>\n<td>7</td>\n<td>bInterfaceProtocol</td>\n<td>1</td>\n<td>接口协议</td>\n</tr>\n<tr>\n<td>8</td>\n<td>iInterface</td>\n<td>1</td>\n<td>该接口字符串描述符索引</td>\n</tr>\n</tbody></table>\n<ul>\n<li><strong>bLength</strong> 1字节，表示接口描述符的长度，标准的接口描述符的长度为9字节。</li>\n<li><strong>bDescriptorType</strong> 1字节，表示描述符的类型，接口描述符的类型编码为 0x04。</li>\n<li><strong>bInterfaceNumber</strong> 1字节，表示该接口的编号，如果一个配置具有多个接口，每个接口的编号都不相同，从0开始依次递增对一个配置的接口进行编号。</li>\n<li><strong>bAlternateSetting</strong> 1字节，接口的备用编号，很少用到，设置为0。</li>\n<li><strong>bNumEndpoints</strong> 1字节，表示该接口的端点数（不包括0端点）。</li>\n<li><strong>bInterfaceClass、bInterfaceSubClass、bInterfaceProtocol</strong> 均为1字节，分别表示接口所使用的类，子类以及协议，由USB协会规定。</li>\n<li><strong>iInterface</strong> 1字节，描述该接口的字符串的索引值，如果为0，表示没有字符串。</li>\n</ul>\n<p><strong>bInterfaceClass</strong>、<strong>bDeviceClass</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>Base Class</th>\n<th>Descriptor Usage</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>00h</td>\n<td>Device</td>\n<td>Use class information in the Interface Descriptors</td>\n</tr>\n<tr>\n<td>01h</td>\n<td>Interface</td>\n<td>Audio USB音频，参见UAC规范</td>\n</tr>\n<tr>\n<td>02h</td>\n<td>Both</td>\n<td>Communications and <a href=\"https://www.usbzh.com/article/detail-842.html\">CDC</a> Control 网卡、调制解调器、串列端口</td>\n</tr>\n<tr>\n<td>03h</td>\n<td>Interface</td>\n<td><a href=\"https://www.usbzh.com/article/detail-76.html\">HID</a> (Human Interface Device)，键盘、鼠标 参见<a href=\"https://www.usbzh.com/article/detail-76.html\">HID</a>规范</td>\n</tr>\n<tr>\n<td>05h</td>\n<td>Interface</td>\n<td>Physical 控制杆</td>\n</tr>\n<tr>\n<td>06h</td>\n<td>Interface</td>\n<td>Image 影像扫描仪、Picture Transfer Protocol</td>\n</tr>\n<tr>\n<td>07h</td>\n<td>Interface</td>\n<td>Printer 打印机</td>\n</tr>\n<tr>\n<td>08h</td>\n<td>Interface</td>\n<td>Mass Storage U盘、移动硬盘、存储卡读卡器、数字相机</td>\n</tr>\n<tr>\n<td>09h</td>\n<td>Device</td>\n<td>Hub <a href=\"https://www.usbzh.com/article/detail-25.html\">集线器</a></td>\n</tr>\n<tr>\n<td>0Ah</td>\n<td>Interface</td>\n<td><a href=\"https://www.usbzh.com/article/detail-842.html\">CDC</a>-Data 调制解调器、网络卡、ISDN、传真</td>\n</tr>\n<tr>\n<td>0Bh</td>\n<td>Interface</td>\n<td>Smart Card 读卡器</td>\n</tr>\n<tr>\n<td>0Dh</td>\n<td>Interface</td>\n<td>Content Security</td>\n</tr>\n<tr>\n<td>0Eh</td>\n<td>Interface</td>\n<td>Video USB视频，<a href=\"https://www.usbzh.com/article/detail-80.html\">UVC</a>摄像头，参见<a href=\"https://www.usbzh.com/article/detail-80.html\">UVC</a>规范</td>\n</tr>\n<tr>\n<td>0Fh</td>\n<td>Interface</td>\n<td>Personal Healthcare</td>\n</tr>\n<tr>\n<td>10h</td>\n<td>Interface</td>\n<td>Audio&#x2F;Video Devices</td>\n</tr>\n<tr>\n<td>11h</td>\n<td>Device</td>\n<td>Billboard Device Class</td>\n</tr>\n<tr>\n<td>12h</td>\n<td>Interface</td>\n<td>USB Type-C Bridge Class</td>\n</tr>\n<tr>\n<td>DCh</td>\n<td>Both</td>\n<td>Diagnostic Device</td>\n</tr>\n<tr>\n<td>E0h</td>\n<td>Interface</td>\n<td>Wireless Controller 蓝牙</td>\n</tr>\n<tr>\n<td>EFh</td>\n<td>Both</td>\n<td>Miscellaneous</td>\n</tr>\n<tr>\n<td>FEh</td>\n<td>Interface</td>\n<td>Application Specific 红外线资料桥接器</td>\n</tr>\n<tr>\n<td>FFh</td>\n<td>Both</td>\n<td>Vendor Specific 自定义USB设备</td>\n</tr>\n<tr>\n<td>更多信息参考 <a href=\"https://www.usb.org/defined-class-codes\">USB.org</a> 的部分章节</td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"端点描述符-0x05-Endpoint-Descriptor\"><a href=\"#端点描述符-0x05-Endpoint-Descriptor\" class=\"headerlink\" title=\"端点描述符 0x05 Endpoint Descriptor\"></a>端点描述符 0x05 Endpoint Descriptor</h2><table>\n<thead>\n<tr>\n<th>偏移</th>\n<th>字段</th>\n<th>大小<br>Byte</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>bLength</td>\n<td>1</td>\n<td>该描述符长度 &#x3D; 7 个字节</td>\n</tr>\n<tr>\n<td>1</td>\n<td>bDescriptorType</td>\n<td>1</td>\n<td>描述符类型 &#x3D; 端点（05h）</td>\n</tr>\n<tr>\n<td>2</td>\n<td>bEndpointAddress</td>\n<td>1</td>\n<td><strong>位 3…0</strong>：端点数量 <br/><strong>位 6…4</strong>：预留，复位为零 <br/><strong>位 7</strong>：端点的方向。控制端点可以忽略该位。 <br/>0 &#x3D; OUT 端点 (主机到设备) <br/>1 &#x3D; IN 端点 (设备到主机)</td>\n</tr>\n<tr>\n<td>3</td>\n<td>bmAttributes</td>\n<td>1</td>\n<td><strong>位 1…0</strong>：传输类型 <br/>00 &#x3D; 控制传输 <br/>01 &#x3D; 同步传输 <br/>10 &#x3D; 批量传输 <br/>11 &#x3D; 中断传输 <br/>如果该端点不是同步端点，那么位 5 到位 2 将被预留，必须将这些位设置为零。如果该端点是同步的，这些位将按如下内容定义： <br/><strong>位 3…2</strong>：同步类型 <br/>00 &#x3D; 无同步 <br/>01 &#x3D; 异步 <br/>10 &#x3D; 自适应 <br/>11 &#x3D; 同步 <br/><strong>位 5…4</strong>：用途类型 <br/>00 &#x3D; 数据端点 <br/>01 &#x3D; 反馈端点 <br/>10 &#x3D; 隐式反馈数据端点 <br/>数值 11 表示保留</td>\n</tr>\n<tr>\n<td>4</td>\n<td>wMaxPacketSize</td>\n<td>1</td>\n<td>该端点的数据包最大尺寸</td>\n</tr>\n<tr>\n<td>6</td>\n<td>bInterval</td>\n<td>1</td>\n<td>中断端点的轮询间隔，单位为 ms（对于同步端点，该间隔为 1 ms；控制或批量端点可能忽略该字段）</td>\n</tr>\n</tbody></table>\n<ul>\n<li><strong>bLength</strong> 1字节，表示端点描述符的长度，标准的端点描述符的长度为7字节。</li>\n<li><strong>bDescriptorType</strong> 1字节，表示描述符的类型，端点描述符的类型编码为 0x05。</li>\n<li><strong>bEndpointAddress</strong> 1字节，表示该端点的地址和方向。</li>\n<li><strong>bmAttributes</strong> 1字节，表示该端点的属性，详细看上表。<ul>\n<li><strong>Transfer Type</strong> <ul>\n<li><strong>控制CONTROL</strong> 控制端点被用来控制对 USB 设备的不同部分访问。<em>通常用作配置设备、获取设备信息、发送命令到设备或获取设备状态报告</em>。这些端点通常较小。<em>每个 USB 设备都有一个控制端点称为”端点 0”, 被 USB 核心用来在插入时配置设备</em>。USB协议保证总有足够的带宽留给控制端点传送数据到设备.  </li>\n<li><strong>中断INTERRUPT</strong>每当 USB 主机向设备请求数据时，中断端点以固定的速率传送<em>小量的数据</em>。此为USB 键盘和鼠标的主要的数据传送方法。它还用以传送数据到 USB 设备来控制设备。<em>通常不用来传送大量数据</em>。USB协议保证总有足够的带宽留给中断端点传送数据到设备.</li>\n<li><strong>批量BULK</strong>  批量端点用以传送大量数据。这些端点常比中断端点大得多. 它们普遍用于<em>不能有任何数据丢失的数据</em>。USB 协议<em>不保证传输在特定时间范围内完成</em>。如果总线上没有足够的空间来发送整个BULK包，它被分为多个包进行传输。这些端点普遍用于打印机、USB Mass Storage和USB网络设备上。</li>\n<li><strong>等时ISOCHRONOUS</strong> 等时端点也批量传送大量数据, 但是这个数据<em>不被保证能送达</em>。这些端点用在可以处理数据丢失的设备中，并且更多依赖于保持持续的数据流。如音频和视频设备等等。</li>\n<li>对比总结：<em>控制</em>和<em>批量</em>端点用于异步数据传送，而<em>中断</em>和<em>同步</em>端点是周期性的。这意味着这些端点被设置来在固定的时间连续传送数据，USB 核心为它们保留了相应的带宽。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>wMaxPacketSize</strong> 2字节，表示该端点的数据包最大长度。</li>\n<li><strong>bInterval</strong> 1字节</li>\n</ul>\n<p>每个端点描述符都规定了该端点所支持的最大数据包长 (wMaxPacketSize)，主机每次发送数据包，都不能超过端点的最大包长，各种端点的最大包长如下表：</p>\n<table>\n<thead>\n<tr>\n<th>端点类型</th>\n<th>最大包长 (低速)</th>\n<th>最大包长 (全速)</th>\n<th>最大包长 (高)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>控制端点</td>\n<td>8</td>\n<td>8&#x2F;16&#x2F;32&#x2F;64</td>\n<td>64</td>\n</tr>\n<tr>\n<td>实时端点</td>\n<td>不支持</td>\n<td>1023</td>\n<td>1024</td>\n</tr>\n<tr>\n<td>中断端点</td>\n<td>8</td>\n<td>64</td>\n<td>1024</td>\n</tr>\n<tr>\n<td>批量端点</td>\n<td>不支持</td>\n<td>8&#x2F;16&#x2F;32&#x2F;64</td>\n<td>512</td>\n</tr>\n</tbody></table>\n<h1 id=\"HID\"><a href=\"#HID\" class=\"headerlink\" title=\"HID\"></a>HID</h1><h1 id=\"UVC\"><a href=\"#UVC\" class=\"headerlink\" title=\"UVC\"></a>UVC</h1><blockquote>\n<p>UVC，全称为：USB video(device) class,是微软与另外几家设备厂商联合推出的为USB视频捕获设备定义的协议标准，目前已成为USB org标准之一。</p>\n</blockquote>\n",
            "tags": [
                "embedded",
                "usb"
            ]
        }
    ]
}