{
    "version": "https://jsonfeed.org/version/1",
    "title": "Oikiou's Blog â€¢ All posts by \"https\" tag",
    "description": "Blog",
    "home_page_url": "https://www.oikiou.top",
    "items": [
        {
            "id": "https://www.oikiou.top/2023/e7fefe87/",
            "url": "https://www.oikiou.top/2023/e7fefe87/",
            "title": "Let's Encrypt SSL è¯ä¹¦ç”³è¯·",
            "date_published": "2023-01-12T04:08:08.000Z",
            "content_html": "<h1 id=\"Letâ€™s-Encrypt-SSL-è¯ä¹¦ç”³è¯·\"><a href=\"#Letâ€™s-Encrypt-SSL-è¯ä¹¦ç”³è¯·\" class=\"headerlink\" title=\"Letâ€™s Encrypt SSL è¯ä¹¦ç”³è¯·\"></a>Letâ€™s Encrypt SSL è¯ä¹¦ç”³è¯·</h1><h1 id=\"ä¸ºä»€ä¹ˆç”³è¯·ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆç”³è¯·ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆç”³è¯·ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆç”³è¯·ï¼Ÿ</h1><blockquote>\n<h2 id=\"HTTPï¼šæœªå®æ–½æ•°æ®åŠ å¯†\"><a href=\"#HTTPï¼šæœªå®æ–½æ•°æ®åŠ å¯†\" class=\"headerlink\" title=\"HTTPï¼šæœªå®æ–½æ•°æ®åŠ å¯†\"></a>HTTPï¼šæœªå®æ–½æ•°æ®åŠ å¯†</h2><p>  æ¯ä¸ªä»¥ HTTP å¼€å¤´çš„ URL é“¾æ¥éƒ½ä½¿ç”¨ä¸€ç§åŸºæœ¬ç±»å‹çš„â€œè¶…æ–‡æœ¬ä¼ è¾“åè®®â€ã€‚ç”± Tim Berners-Lee äº 1990 å¹´ä»£åˆåˆ›å»ºï¼Œå½“æ—¶äº’è”ç½‘ä»å¤„äºèµ·æ­¥é˜¶æ®µï¼Œè¯¥ç½‘ç»œåè®®æ ‡å‡†å…è®¸ Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šè¿‡æ•°æ®äº¤æ¢è¿›è¡Œé€šä¿¡ã€‚</p>\n<p>  HTTP ä¹Ÿè¢«ç§°ä¸ºâ€œæ— çŠ¶æ€ç³»ç»Ÿâ€ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æŒ‰éœ€è¿æ¥ã€‚æ‚¨å•å‡»ä¸€ä¸ªé“¾æ¥ï¼Œè¯·æ±‚è¿æ¥ï¼Œæ‚¨çš„ Web æµè§ˆå™¨å°†æ­¤è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡æ‰“å¼€é¡µé¢è¿›è¡Œå“åº”ã€‚è¿æ¥è¶Šå¿«ï¼Œæ•°æ®å‘ˆç°ç»™æ‚¨çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚</p>\n<p>  ä½œä¸ºä¸€ç§â€œåº”ç”¨å±‚åè®®â€ï¼ŒHTTP ä»ç„¶ä¸“æ³¨äºå‘ˆç°ä¿¡æ¯ï¼Œä½†ä¸å¤ªå…³å¿ƒè¿™äº›ä¿¡æ¯ä»ä¸€ä¸ªåœ°æ–¹ä¼ æ’­åˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„æ–¹å¼ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ„å‘³ç€ HTTP å¯èƒ½ä¼š<a href=\"https://www.globalsign.com/en/blog/what-is-a-man-in-the-middle-attack\">è¢«æ‹¦æˆªå¹¶å¯èƒ½è¢«æ›´æ”¹</a>ï¼Œä»è€Œä½¿ä¿¡æ¯å’Œä¿¡æ¯æ¥æ”¶è€…ï¼ˆå³æ‚¨ï¼‰éƒ½å®¹æ˜“å—åˆ°æ”»å‡»ã€‚</p>\n<h2 id=\"HTTPSï¼šåŠ å¯†è¿æ¥\"><a href=\"#HTTPSï¼šåŠ å¯†è¿æ¥\" class=\"headerlink\" title=\"HTTPSï¼šåŠ å¯†è¿æ¥\"></a>HTTPSï¼šåŠ å¯†è¿æ¥</h2><p>  HTTPS ä¸æ˜¯ HTTP çš„å¯¹ç«‹é¢ï¼Œè€Œæ˜¯å®ƒçš„è¡¨å¼Ÿã€‚ä¸¤è€…æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½æŒ‡çš„æ˜¯ç›¸åŒçš„â€œè¶…æ–‡æœ¬ä¼ è¾“åè®®â€ï¼Œè¯¥åè®®ä½¿è¯·æ±‚çš„ Web æ•°æ®èƒ½å¤Ÿæ˜¾ç¤ºåœ¨æ‚¨çš„å±å¹•ä¸Šã€‚ä½†æ˜¯ï¼ŒHTTPS ä»ç„¶ç•¥æœ‰ä¸åŒï¼Œæ›´å…ˆè¿›ï¼Œä¹Ÿæ›´å®‰å…¨ã€‚</p>\n<p>  ç®€å•çš„è¯´ï¼ŒHTTPSåè®®æ˜¯HTTPçš„æ‰©å±•ã€‚ç¼©å†™ä¸­çš„â€œSâ€æ¥è‡ª Secure ä¸€è¯ï¼Œå®ƒç”±ä¼ è¾“å±‚å®‰å…¨æ€§ (TLS) [<a href=\"https://www.globalsign.com/en/ssl-information-center/what-is-ssl/\">å®‰å…¨å¥—æ¥å­—å±‚ (SSL)</a>çš„åç»§è€…] æä¾›æ”¯æŒï¼Œè¿™æ˜¯ä¸€ç§åœ¨ Web æœåŠ¡å™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹åŠ å¯†è¿æ¥çš„æ ‡å‡†å®‰å…¨æŠ€æœ¯ã€‚æµè§ˆå™¨ã€‚</p>\n<p>  å¦‚æœæ²¡æœ‰ HTTPSï¼Œæ‚¨è¾“å…¥ç½‘ç«™çš„ä»»ä½•æ•°æ®ï¼ˆä¾‹å¦‚æ‚¨çš„ç”¨æˆ·å&#x2F;å¯†ç ã€ä¿¡ç”¨å¡æˆ–é“¶è¡Œè¯¦ç»†ä¿¡æ¯ã€ä»»ä½•å…¶ä»–è¡¨å•æäº¤æ•°æ®ç­‰ï¼‰éƒ½å°†ä»¥æ˜æ–‡å½¢å¼å‘é€ï¼Œå› æ­¤å®¹æ˜“è¢«æ‹¦æˆªæˆ–çªƒå¬ã€‚å› æ­¤ï¼Œåœ¨è¾“å…¥ä»»ä½•ä¿¡æ¯ä¹‹å‰ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆæ£€æŸ¥ç«™ç‚¹æ˜¯å¦ä½¿ç”¨ HTTPSã€‚</p>\n<p>  é™¤äº†åŠ å¯†æœåŠ¡å™¨å’Œæ‚¨çš„æµè§ˆå™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®å¤–ï¼ŒTLS è¿˜éªŒè¯æ‚¨æ­£åœ¨è¿æ¥çš„æœåŠ¡å™¨å¹¶ä¿æŠ¤ä¼ è¾“çš„æ•°æ®ä¸è¢«ç¯¡æ”¹ã€‚</p>\n<p>  è¿™æœ‰åŠ©äºæˆ‘è¿™æ ·æ€è€ƒâ€”â€”HTTPS ä¸­çš„ HTTP ç›¸å½“äºä¸€ä¸ªç›®çš„åœ°ï¼Œè€Œ SSL ç›¸å½“äºä¸€ä¸ªæ—…ç¨‹ã€‚ç¬¬ä¸€ä¸ªè´Ÿè´£å°†æ•°æ®æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œç¬¬äºŒä¸ªè´Ÿè´£ç®¡ç†æ•°æ®åˆ°è¾¾é‚£é‡Œçš„æ–¹å¼ã€‚é€šè¿‡è”åˆåŠ›é‡ï¼Œä»–ä»¬ä»¥å®‰å…¨çš„æ–¹å¼ç§»åŠ¨æ•°æ®ã€‚  </p>\n<p>  <a href=\"https://www.globalsign.com/en/blog/the-difference-between-http-and-https\">Whatâ€™s the difference between HTTP and HTTPS?</a></p>\n</blockquote>\n<p>HTTPS æœ‰åŠ©äºç¡®ä¿ç½‘ç»œå®‰å…¨ã€‚æ¯«æ— ç–‘é—®ï¼Œå®ƒæ˜¯æ¯” HTTP æ›´å¥½çš„ç½‘ç»œåè®®è§£å†³æ–¹æ¡ˆã€‚</p>\n<p>å°†ç½‘ç«™å¼€å¯HTTPSçš„æœåŠ¡æ˜¯éœ€è¦SSLçš„è¯ä¹¦çš„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨Letâ€™s Encryptä¸Šç”³è¯·å…è´¹çš„SSLè¯ä¹¦ã€‚</p>\n<blockquote>\n<p>  Letâ€™s Encrypt æ˜¯å…è´¹ã€å¼€æ”¾å’Œè‡ªåŠ¨åŒ–çš„è¯ä¹¦é¢å‘æœºæ„ã€‚ç”±éç›ˆåˆ©ç»„ç»‡<a href=\"https://www.abetterinternet.org/\">äº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ï¼ˆISRGï¼‰</a>è¿è¥ã€‚</p>\n</blockquote>\n<h1 id=\"ç”³è¯·çš„å‰ææ¡ä»¶\"><a href=\"#ç”³è¯·çš„å‰ææ¡ä»¶\" class=\"headerlink\" title=\"ç”³è¯·çš„å‰ææ¡ä»¶\"></a>ç”³è¯·çš„å‰ææ¡ä»¶</h1><p>æˆ‘ä»¬ç”³è¯·SSLè¯ä¹¦çš„å‰ææ¡ä»¶æœ‰ä¸‹é¢è¿™å‡ ä¸ª</p>\n<ol>\n<li>æ‹¥æœ‰åŸŸåï¼Œèƒ½å¤Ÿè‡ªä¸»é…ç½®DNSã€‚æˆ–è€…æä¾›WebæœåŠ¡å™¨åšéªŒè¯ï¼Œåœ¨ç½‘ç«™ç›®å½•ä¸‹æ”¾ä¸€ä¸ªæ–‡ä»¶ã€‚</li>\n<li>è·å–è¯ä¹¦çš„ç¯å¢ƒè¦èƒ½è®¿é—®DNSæœåŠ¡å™¨ï¼Œå› ä¸ºä¼šéœ€è¦åšDNSè§£ææ ¡éªŒã€‚</li>\n<li>éœ€è¦æœ‰è¿œç¨‹ä¸»æœºçš„æƒé™ï¼Œä¼šéœ€è¦æ›´æ–°å’Œå®‰è£…ç»„ä»¶ã€‚</li>\n<li>å…¬ç½‘IPï¼Œä¿ç•™åœ°å€æ— æ³•ç”³è¯·SSLã€‚</li>\n</ol>\n<h1 id=\"ç”³è¯·æ­¥éª¤\"><a href=\"#ç”³è¯·æ­¥éª¤\" class=\"headerlink\" title=\"ç”³è¯·æ­¥éª¤\"></a>ç”³è¯·æ­¥éª¤</h1><p>Letâ€™s Encrypt çš„è¯ä¹¦ç”³è¯·é™¤å»æ‰‹åŠ¨ç”³è¯·å¸¸è§çš„ä¸»è¦æœ‰ä¸‹é¢è¿™å‡ ç§</p>\n<ul>\n<li><code>acme.sh</code>çš„æ–¹å¼<em>ï¼ˆæˆ‘å½“æ—¶é€‰å–äº†è¿™ä¸ªæ–¹å¼ï¼‰</em></li>\n<li>docker é•œåƒè·å–</li>\n<li><code>certbot</code>æ–¹å¼è·å–è¯ä¹¦<em>ï¼ˆå®˜ç½‘å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼è·å–è¯ä¹¦ï¼Œå¯ä»¥åœ¨ä¸ä¸‹çº¿çš„çŠ¶æ€ä¸‹è‡ªåŠ¨æ‰§è¡Œè¯ä¹¦é¢å‘å’Œå®‰è£…ï¼‰</em></li>\n</ul>\n<h2 id=\"acme-shè„šæœ¬\"><a href=\"#acme-shè„šæœ¬\" class=\"headerlink\" title=\"acme.shè„šæœ¬\"></a><code>acme.sh</code>è„šæœ¬</h2><p><a href=\"https://github.com/acmesh-official/acme.sh\">Githubé“¾æ¥ï¼šAn ACME Shell script: acme.sh</a></p>\n<p>Githubçš„READMEå…¶å®ä»‹ç»çš„å…¶å®å¾ˆå…¨é¢ï¼Œè¿™é‡Œcopyä¸€ä¸‹ã€‚</p>\n<blockquote>\n<p>  <strong>acme.sh</strong> å®ç°äº† <code>acme</code> åè®®, å¯ä»¥ä» letsencrypt ç”Ÿæˆå…è´¹çš„è¯ä¹¦.</p>\n<p>  ä¸»è¦æ­¥éª¤:</p>\n<ol>\n<li>å®‰è£… <strong>acme.sh</strong></li>\n<li>ç”Ÿæˆè¯ä¹¦</li>\n<li>copy è¯ä¹¦åˆ° nginx&#x2F;apache æˆ–è€…å…¶ä»–æœåŠ¡</li>\n<li>æ›´æ–°è¯ä¹¦</li>\n<li>æ›´æ–° <strong>acme.sh</strong></li>\n<li>å‡ºé”™æ€ä¹ˆåŠ, å¦‚ä½•è°ƒè¯•</li>\n</ol>\n<p>  ä¸‹é¢è¯¦ç»†ä»‹ç».</p>\n<h1 id=\"1-å®‰è£…-acme-sh\"><a href=\"#1-å®‰è£…-acme-sh\" class=\"headerlink\" title=\"1. å®‰è£… acme.sh\"></a>1. å®‰è£… <strong>acme.sh</strong></h1><p>  å®‰è£…å¾ˆç®€å•, ä¸€ä¸ªå‘½ä»¤:</p>\n<blockquote>\n<p>  è¿™é‡Œè¾“å…¥ä½ çš„é‚®ç®±ï¼Œè¿™ä¸ªé‚®ç®±æœ‰ä»€ä¹ˆç”¨å€’æ˜¯ä¸å¤ªæ¸…æ¥š</p>\n</blockquote>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">curl https://get.acme.sh | sh -s email=my@example.com<br></code></pre></td></tr></table></figure>\n\n<p>  æ™®é€šç”¨æˆ·å’Œ root ç”¨æˆ·éƒ½å¯ä»¥å®‰è£…ä½¿ç”¨. å®‰è£…è¿‡ç¨‹è¿›è¡Œäº†ä»¥ä¸‹å‡ æ­¥:</p>\n<ol>\n<li>æŠŠ acme.sh å®‰è£…åˆ°ä½ çš„ <strong>home</strong> ç›®å½•ä¸‹:</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">~/.acme.sh/<br></code></pre></td></tr></table></figure>\n\n<p>  å¹¶åˆ›å»º ä¸€ä¸ª shell çš„ alias, ä¾‹å¦‚ .bashrcï¼Œæ–¹ä¾¿ä½ çš„ä½¿ç”¨: <code>alias acme.sh=~/.acme.sh/acme.sh</code></p>\n<ol start=\"2\">\n<li>è‡ªåŠ¨ä¸ºä½ åˆ›å»º cronjob, æ¯å¤© 0:00 ç‚¹è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰çš„è¯ä¹¦, å¦‚æœå¿«è¿‡æœŸäº†, éœ€è¦æ›´æ–°, åˆ™ä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦.</li>\n</ol>\n<p>  æ›´é«˜çº§çš„å®‰è£…é€‰é¡¹è¯·å‚è€ƒ: <a href=\"https://github.com/Neilpang/acme.sh/wiki/How-to-install\">https://github.com/Neilpang/acme.sh/wiki/How-to-install</a></p>\n<p>  <strong>å®‰è£…è¿‡ç¨‹ä¸ä¼šæ±¡æŸ“å·²æœ‰çš„ç³»ç»Ÿä»»ä½•åŠŸèƒ½å’Œæ–‡ä»¶</strong>, æ‰€æœ‰çš„ä¿®æ”¹éƒ½é™åˆ¶åœ¨å®‰è£…ç›®å½•ä¸­: <code>~/.acme.sh/</code></p>\n<h1 id=\"2-ç”Ÿæˆè¯ä¹¦\"><a href=\"#2-ç”Ÿæˆè¯ä¹¦\" class=\"headerlink\" title=\"2. ç”Ÿæˆè¯ä¹¦\"></a>2. ç”Ÿæˆè¯ä¹¦</h1><p>  <strong>acme.sh</strong> å®ç°äº† <strong>acme</strong> åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®. ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: http å’Œ dns éªŒè¯.</p>\n<h3 id=\"1-http-æ–¹å¼éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶-æ¥éªŒè¯ä½ çš„åŸŸåæ‰€æœ‰æƒ-å®ŒæˆéªŒè¯-ç„¶åå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†\"><a href=\"#1-http-æ–¹å¼éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶-æ¥éªŒè¯ä½ çš„åŸŸåæ‰€æœ‰æƒ-å®ŒæˆéªŒè¯-ç„¶åå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†\" class=\"headerlink\" title=\"1. http æ–¹å¼éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶, æ¥éªŒè¯ä½ çš„åŸŸåæ‰€æœ‰æƒ,å®ŒæˆéªŒè¯. ç„¶åå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†.\"></a>1. http æ–¹å¼éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ç½®ä¸€ä¸ªæ–‡ä»¶, æ¥éªŒè¯ä½ çš„åŸŸåæ‰€æœ‰æƒ,å®ŒæˆéªŒè¯. ç„¶åå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†.</h3>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">acme.sh --issue -d mydomain.com -d www.mydomain.com --webroot /home/wwwroot/mydomain.com/<br></code></pre></td></tr></table></figure>\n\n<p>  åªéœ€è¦æŒ‡å®šåŸŸå, å¹¶æŒ‡å®šåŸŸåæ‰€åœ¨çš„ç½‘ç«™æ ¹ç›®å½•. <strong>acme.sh</strong> ä¼šå…¨è‡ªåŠ¨çš„ç”ŸæˆéªŒè¯æ–‡ä»¶, å¹¶æ”¾åˆ°ç½‘ç«™çš„æ ¹ç›®å½•, ç„¶åè‡ªåŠ¨å®ŒæˆéªŒè¯. æœ€åä¼šèªæ˜çš„åˆ é™¤éªŒè¯æ–‡ä»¶. æ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨.</p>\n<p>  å¦‚æœä½ ç”¨çš„ <strong>apache</strong>æœåŠ¡å™¨, <strong>acme.sh</strong> è¿˜å¯ä»¥æ™ºèƒ½çš„ä» <strong>apache</strong>çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯, ä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--issue</span> -d mydomain<span class=\"hljs-selector-class\">.com</span> <span class=\"hljs-attr\">--apache</span><br></code></pre></td></tr></table></figure>\n\n<p>  å¦‚æœä½ ç”¨çš„ <strong>nginx</strong>æœåŠ¡å™¨, æˆ–è€…åä»£, <strong>acme.sh</strong> è¿˜å¯ä»¥æ™ºèƒ½çš„ä» <strong>nginx</strong>çš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯, ä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--issue</span> -d mydomain<span class=\"hljs-selector-class\">.com</span> <span class=\"hljs-attr\">--nginx</span><br></code></pre></td></tr></table></figure>\n\n<p>  <strong>æ³¨æ„, æ— è®ºæ˜¯ apache è¿˜æ˜¯ nginx æ¨¡å¼, acme.shåœ¨å®ŒæˆéªŒè¯ä¹‹å, ä¼šæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€, éƒ½ä¸ä¼šç§è‡ªæ›´æ”¹ä½ æœ¬èº«çš„é…ç½®. å¥½å¤„æ˜¯ä½ ä¸ç”¨æ‹…å¿ƒé…ç½®è¢«æå, ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹, ä½ éœ€è¦è‡ªå·±é…ç½® ssl çš„é…ç½®, å¦åˆ™åªèƒ½æˆåŠŸç”Ÿæˆè¯ä¹¦, ä½ çš„ç½‘ç«™è¿˜æ˜¯æ— æ³•è®¿é—®https. ä½†æ˜¯ä¸ºäº†å®‰å…¨, ä½ è¿˜æ˜¯è‡ªå·±æ‰‹åŠ¨æ”¹é…ç½®å§.</strong></p>\n<p>  å¦‚æœä½ è¿˜æ²¡æœ‰è¿è¡Œä»»ä½• web æœåŠ¡, <strong>80</strong> ç«¯å£æ˜¯ç©ºé—²çš„, é‚£ä¹ˆ <strong>acme.sh</strong> è¿˜èƒ½å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ªwebserver, ä¸´æ—¶å¬åœ¨<strong>80</strong> ç«¯å£, å®ŒæˆéªŒè¯:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--issue</span> -d mydomain<span class=\"hljs-selector-class\">.com</span> <span class=\"hljs-attr\">--standalone</span><br></code></pre></td></tr></table></figure>\n\n<p>  æ›´é«˜çº§çš„ç”¨æ³•è¯·å‚è€ƒ: <a href=\"https://github.com/Neilpang/acme.sh/wiki/How-to-issue-a-cert\">https://github.com/Neilpang/acme.sh/wiki/How-to-issue-a-cert</a></p>\n<h3 id=\"2-æ‰‹åŠ¨-dns-æ–¹å¼-æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡-txt-è§£æè®°å½•-éªŒè¯åŸŸåæ‰€æœ‰æƒ\"><a href=\"#2-æ‰‹åŠ¨-dns-æ–¹å¼-æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡-txt-è§£æè®°å½•-éªŒè¯åŸŸåæ‰€æœ‰æƒ\" class=\"headerlink\" title=\"2. æ‰‹åŠ¨ dns æ–¹å¼, æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ txt è§£æè®°å½•, éªŒè¯åŸŸåæ‰€æœ‰æƒ.\"></a>2. æ‰‹åŠ¨ dns æ–¹å¼, æ‰‹åŠ¨åœ¨åŸŸåä¸Šæ·»åŠ ä¸€æ¡ txt è§£æè®°å½•, éªŒè¯åŸŸåæ‰€æœ‰æƒ.</h3><p>  è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯, ä½ ä¸éœ€è¦ä»»ä½•æœåŠ¡å™¨, ä¸éœ€è¦ä»»ä½•å…¬ç½‘ ip, åªéœ€è¦ dns çš„è§£æè®°å½•å³å¯å®ŒæˆéªŒè¯. åå¤„æ˜¯ï¼Œå¦‚æœä¸åŒæ—¶é…ç½® Automatic DNS APIï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ acme.sh å°†æ— æ³•è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨å†æ¬¡é‡æ–°è§£æéªŒè¯åŸŸåæ‰€æœ‰æƒã€‚</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--issue</span> <span class=\"hljs-attr\">--dns</span> -d mydomain<span class=\"hljs-selector-class\">.com</span> \\<br> <span class=\"hljs-attr\">--yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></code></pre></td></tr></table></figure>\n\n<p>  ç„¶å, <strong>acme.sh</strong> ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥, ä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ txt è®°å½•å³å¯.</p>\n<p>  ç­‰å¾…è§£æå®Œæˆä¹‹å, é‡æ–°ç”Ÿæˆè¯ä¹¦:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--renew</span> -d mydomain<span class=\"hljs-selector-class\">.com</span> \\<br>  <span class=\"hljs-attr\">--yes-I-know-dns-manual-mode-enough-go-ahead-please</span><br></code></pre></td></tr></table></figure>\n\n<p>  æ³¨æ„ç¬¬äºŒæ¬¡è¿™é‡Œç”¨çš„æ˜¯ <code>--renew</code></p>\n<p>  dns æ–¹å¼çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå¯ä»¥ä½¿ç”¨åŸŸåè§£æå•†æä¾›çš„ api è‡ªåŠ¨æ·»åŠ  txt è®°å½•å®ŒæˆéªŒè¯.</p>\n<p>  <strong>acme.sh</strong> ç›®å‰æ”¯æŒ cloudflare, dnspod, cloudxns, godaddy ä»¥åŠ ovh ç­‰æ•°åç§è§£æå•†çš„è‡ªåŠ¨é›†æˆ.</p>\n<p>  ä»¥ dnspod ä¸ºä¾‹, ä½ éœ€è¦å…ˆç™»å½•åˆ° dnspod è´¦å·, ç”Ÿæˆä½ çš„ api id å’Œ api key, éƒ½æ˜¯å…è´¹çš„. ç„¶å:</p>\n  <figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\"><span class=\"hljs-built_in\">export</span> <span class=\"hljs-attribute\">DP_Id</span>=<span class=\"hljs-string\">&quot;1234&quot;</span><br><br><span class=\"hljs-built_in\">export</span> <span class=\"hljs-attribute\">DP_Key</span>=<span class=\"hljs-string\">&quot;sADDsdasdgdsf&quot;</span><br><br>acme.sh --issue --dns dns_dp -d aa.com -d www.aa.com<br></code></pre></td></tr></table></figure>\n\n<p>  è¯ä¹¦å°±ä¼šè‡ªåŠ¨ç”Ÿæˆäº†. è¿™é‡Œç»™å‡ºçš„ api id å’Œ api key ä¼šè¢«è‡ªåŠ¨è®°å½•ä¸‹æ¥, å°†æ¥ä½ åœ¨ä½¿ç”¨ dnspod api çš„æ—¶å€™, å°±ä¸éœ€è¦å†æ¬¡æŒ‡å®šäº†. ç›´æ¥ç”Ÿæˆå°±å¥½äº†:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--issue</span> -d mydomain2<span class=\"hljs-selector-class\">.com</span> <span class=\"hljs-attr\">--dns</span>  dns_dp<br></code></pre></td></tr></table></figure>\n\n<p>  æ›´è¯¦ç»†çš„ api ç”¨æ³•: <a href=\"https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md\">https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md</a></p>\n<h3 id=\"3-å…¶ä»–çš„æ¿€æ´»æ–¹å¼\"><a href=\"#3-å…¶ä»–çš„æ¿€æ´»æ–¹å¼\" class=\"headerlink\" title=\"3. å…¶ä»–çš„æ¿€æ´»æ–¹å¼\"></a>3. å…¶ä»–çš„æ¿€æ´»æ–¹å¼</h3><p>  <a href=\"https://github.com/acmesh-official/acme.sh/wiki/How-to-issue-a-cert\">https://github.com/acmesh-official/acme.sh/wiki/How-to-issue-a-cert</a></p>\n<h1 id=\"3-copy-å®‰è£…-è¯ä¹¦\"><a href=\"#3-copy-å®‰è£…-è¯ä¹¦\" class=\"headerlink\" title=\"3. copy&#x2F;å®‰è£… è¯ä¹¦\"></a>3. copy&#x2F;å®‰è£… è¯ä¹¦</h1><p>  å‰é¢è¯ä¹¦ç”Ÿæˆä»¥å, æ¥ä¸‹æ¥éœ€è¦æŠŠè¯ä¹¦ copy åˆ°çœŸæ­£éœ€è¦ç”¨å®ƒçš„åœ°æ–¹.</p>\n<p>  æ³¨æ„, é»˜è®¤ç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨å®‰è£…ç›®å½•ä¸‹: <code>~/.acme.sh/</code>, <strong>è¯·ä¸è¦ç›´æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶,</strong> ä¾‹å¦‚: ä¸è¦ç›´æ¥è®© nginx&#x2F;apache çš„é…ç½®æ–‡ä»¶ä½¿ç”¨è¿™ä¸‹é¢çš„æ–‡ä»¶. è¿™é‡Œé¢çš„æ–‡ä»¶éƒ½æ˜¯å†…éƒ¨ä½¿ç”¨, è€Œä¸”ç›®å½•ç»“æ„å¯èƒ½ä¼šå˜åŒ–.</p>\n<p>  æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨ <code>--install-cert</code> å‘½ä»¤,å¹¶æŒ‡å®šç›®æ ‡ä½ç½®, ç„¶åè¯ä¹¦æ–‡ä»¶ä¼šè¢«copyåˆ°ç›¸åº”çš„ä½ç½®, ä¾‹å¦‚:</p>\n<h2 id=\"Apache-example\"><a href=\"#Apache-example\" class=\"headerlink\" title=\"Apache example:\"></a>Apache example:</h2>  <figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs gradle\">acme.sh --install-cert -d example.com \\<br>--cert-<span class=\"hljs-keyword\">file</span>      <span class=\"hljs-regexp\">/path/</span>to<span class=\"hljs-regexp\">/certfile/i</span>n<span class=\"hljs-regexp\">/apache/</span>cert.pem  \\<br>--key-<span class=\"hljs-keyword\">file</span>       <span class=\"hljs-regexp\">/path/</span>to<span class=\"hljs-regexp\">/keyfile/i</span>n<span class=\"hljs-regexp\">/apache/</span>key.pem  \\<br>--fullchain-<span class=\"hljs-keyword\">file</span> <span class=\"hljs-regexp\">/path/</span>to<span class=\"hljs-regexp\">/fullchain/</span>certfile<span class=\"hljs-regexp\">/apache/</span>fullchain.pem \\<br>--reloadcmd     <span class=\"hljs-string\">&quot;service apache2 force-reload&quot;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Nginx-example\"><a href=\"#Nginx-example\" class=\"headerlink\" title=\"Nginx example:\"></a>Nginx example:</h2>  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--install-cert</span> -d example<span class=\"hljs-selector-class\">.com</span> \\<br><span class=\"hljs-attr\">--key-file</span>       /path/to/keyfile/<span class=\"hljs-keyword\">in</span>/nginx/key<span class=\"hljs-selector-class\">.pem</span>  \\<br><span class=\"hljs-attr\">--fullchain-file</span> /path/to/fullchain/nginx/cert<span class=\"hljs-selector-class\">.pem</span> \\<br><span class=\"hljs-attr\">--reloadcmd</span>     <span class=\"hljs-string\">&quot;service nginx force-reload&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>  (ä¸€ä¸ªå°æé†’, è¿™é‡Œç”¨çš„æ˜¯ <code>service nginx force-reload</code>, ä¸æ˜¯ <code>service nginx reload</code>, æ®æµ‹è¯•, <code>reload</code> å¹¶ä¸ä¼šé‡æ–°åŠ è½½è¯ä¹¦, æ‰€ä»¥ç”¨çš„ <code>force-reload</code>)</p>\n<blockquote>\n<p>  æˆ‘å½“æ—¶ä½¿ç”¨è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™å‘ç°ç”¨ <code>service nginx force-reload</code>  æŠ¥æ²¡æœ‰æƒé™ï¼Œç„¶åæ˜¯å°†å½“å‰ç”¨æˆ·</p>\n</blockquote>\n<p>  Nginx çš„é…ç½® <code>ssl_certificate</code> ä½¿ç”¨ <code>/etc/nginx/ssl/fullchain.cer</code> ï¼Œè€Œé <code>/etc/nginx/ssl/&lt;domain&gt;.cer</code> ï¼Œå¦åˆ™ <a href=\"https://www.ssllabs.com/ssltest/\">SSL Labs</a> çš„æµ‹è¯•ä¼šæŠ¥ <code>Chain issues Incomplete</code> é”™è¯¯ã€‚</p>\n<p>  <code>--install-cert</code>å‘½ä»¤å¯ä»¥æºå¸¦å¾ˆå¤šå‚æ•°, æ¥æŒ‡å®šç›®æ ‡æ–‡ä»¶. å¹¶ä¸”å¯ä»¥æŒ‡å®š reloadcmd, å½“è¯ä¹¦æ›´æ–°ä»¥å, reloadcmdä¼šè¢«è‡ªåŠ¨è°ƒç”¨,è®©æœåŠ¡å™¨ç”Ÿæ•ˆ.</p>\n<p>  è¯¦ç»†å‚æ•°è¯·å‚è€ƒ: <a href=\"https://github.com/Neilpang/acme.sh#3-install-the-issued-cert-to-apachenginx-etc\">https://github.com/Neilpang/acme.sh#3-install-the-issued-cert-to-apachenginx-etc</a></p>\n<p>  å€¼å¾—æ³¨æ„çš„æ˜¯, è¿™é‡ŒæŒ‡å®šçš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«è‡ªåŠ¨è®°å½•ä¸‹æ¥, å¹¶åœ¨å°†æ¥è¯ä¹¦è‡ªåŠ¨æ›´æ–°ä»¥å, è¢«å†æ¬¡è‡ªåŠ¨è°ƒç”¨.</p>\n<h1 id=\"4-æŸ¥çœ‹å·²å®‰è£…è¯ä¹¦ä¿¡æ¯\"><a href=\"#4-æŸ¥çœ‹å·²å®‰è£…è¯ä¹¦ä¿¡æ¯\" class=\"headerlink\" title=\"4. æŸ¥çœ‹å·²å®‰è£…è¯ä¹¦ä¿¡æ¯\"></a>4. æŸ¥çœ‹å·²å®‰è£…è¯ä¹¦ä¿¡æ¯</h1>  <figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">acme.sh --<span class=\"hljs-built_in\">info</span> -d example.com<br><span class=\"hljs-comment\"># ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</span><br><span class=\"hljs-attribute\">DOMAIN_CONF</span>=/root/.acme.sh/example.com/example.com.conf<br><span class=\"hljs-attribute\">Le_Domain</span>=example.com<br><span class=\"hljs-attribute\">Le_Alt</span>=<span class=\"hljs-literal\">no</span><br><span class=\"hljs-attribute\">Le_Webroot</span>=dns_ali<br>Le_PreHook=<br>Le_PostHook=<br>Le_RenewHook=<br><span class=\"hljs-attribute\">Le_API</span>=https://acme-v02.api.letsencrypt.org/directory<br>Le_Keylength=<br><span class=\"hljs-attribute\">Le_OrderFinalize</span>=https://acme-v02.api.letsencrypt.org/acme/finalize/23xxxx150/781xxxx4310<br><span class=\"hljs-attribute\">Le_LinkOrder</span>=https://acme-v02.api.letsencrypt.org/acme/order/233xxx150/781xxxx4310<br><span class=\"hljs-attribute\">Le_LinkCert</span>=https://acme-v02.api.letsencrypt.org/acme/cert/04cbd28xxxxxx349ecaea8d07<br><span class=\"hljs-attribute\">Le_CertCreateTime</span>=1649358725<br><span class=\"hljs-attribute\">Le_CertCreateTimeStr</span>=Thu Apr  7 19:12:05 UTC 2022<br><span class=\"hljs-attribute\">Le_NextRenewTimeStr</span>=Mon Jun  6 19:12:05 UTC 2022<br><span class=\"hljs-attribute\">Le_NextRenewTime</span>=1654456325<br>Le_RealCertPath=<br>Le_RealCACertPath=<br><span class=\"hljs-attribute\">Le_RealKeyPath</span>=/etc/acme/example.com/privkey.pem<br><span class=\"hljs-attribute\">Le_ReloadCmd</span>=service nginx force-reload<br><span class=\"hljs-attribute\">Le_RealFullChainPath</span>=/etc/acme/example.com/chain.pem<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"5-æ›´æ–°è¯ä¹¦\"><a href=\"#5-æ›´æ–°è¯ä¹¦\" class=\"headerlink\" title=\"5. æ›´æ–°è¯ä¹¦\"></a>5. æ›´æ–°è¯ä¹¦</h1><p>  ç›®å‰è¯ä¹¦åœ¨ 60 å¤©ä»¥åä¼šè‡ªåŠ¨æ›´æ–°, ä½ æ— éœ€ä»»ä½•æ“ä½œ. ä»Šåæœ‰å¯èƒ½ä¼šç¼©çŸ­è¿™ä¸ªæ—¶é—´, ä¸è¿‡éƒ½æ˜¯è‡ªåŠ¨çš„, ä½ ä¸ç”¨å…³å¿ƒ.</p>\n<p>  è¯·ç¡®ä¿ cronjob æ­£ç¡®å®‰è£…, çœ‹èµ·æ¥æ˜¯ç±»ä¼¼è¿™æ ·çš„:</p>\n  <figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jboss-cli\">crontab  -l<br><br>56 * * * * <span class=\"hljs-string\">&quot;/root/.acme.sh&quot;</span><span class=\"hljs-string\">/acme.sh</span> <span class=\"hljs-params\">--cron</span> <span class=\"hljs-params\">--home</span> <span class=\"hljs-string\">&quot;/root/.acme.sh&quot;</span> &gt; <span class=\"hljs-string\">/dev/null</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"6-å…³äºä¿®æ”¹ReloadCmd\"><a href=\"#6-å…³äºä¿®æ”¹ReloadCmd\" class=\"headerlink\" title=\"6. å…³äºä¿®æ”¹ReloadCmd\"></a>6. å…³äºä¿®æ”¹ReloadCmd</h1><p>  ç›®å‰ä¿®æ”¹<code>ReloadCmd</code>æ²¡æœ‰ä¸“é—¨çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡é‡æ–°å®‰è£…è¯ä¹¦æ¥å®ç°ä¿®æ”¹<code>reloadCmd</code>çš„ç›®çš„ã€‚ æ­¤å¤–ï¼Œå®‰è£…è¯ä¹¦åï¼Œç›¸å…³ä¿¡æ¯æ˜¯ä¿å­˜åœ¨<code>~/.acme.sh/example.com/example.conf</code>æ–‡ä»¶ä¸‹çš„ï¼Œå†…å®¹å°±æ˜¯<code>acme.sh --info -d example.com</code>è¾“å‡ºçš„ä¿¡æ¯ï¼Œä¸è¿‡<code>ReloadCmd</code>åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨äº†Base64ç¼–ç ã€‚ç†è®ºä¸Šå¯ä»¥é€šè¿‡ç›´æ¥ä¿®æ”¹è¯¥æ–‡ä»¶æ¥ä¿®æ”¹<code>ReloadCmd</code>ï¼Œä¸”ä¿®æ”¹æ—¶ï¼Œæ— éœ€Base64ç¼–ç ï¼Œç›´æ¥å†™å‘½ä»¤åŸæ–‡<code>acme.sh</code>ä¹Ÿå¯ä»¥è¯†åˆ«ã€‚ ä¸è¿‡ï¼Œ<code>example.conf</code>æ–‡ä»¶çš„ä½ç½®å’Œå†…å®¹æ ¼å¼ä»¥åå¯èƒ½ä¼šæ”¹å˜ï¼<code>example.conf</code>ä¸€ç›´éƒ½æ˜¯å†…éƒ¨ä½¿ç”¨, åé¢æœ‰å¯èƒ½ä¼šæ”¹ä¸ºç”¨ sqlite æˆ–è€…mysql æ ¼å¼å­˜å‚¨. æ‰€ä»¥ä¸€èˆ¬ä¸å»ºè®®è‡ªå·±ä¿®æ”¹ã€‚</p>\n<h1 id=\"7-æ›´æ–°-acme-sh\"><a href=\"#7-æ›´æ–°-acme-sh\" class=\"headerlink\" title=\"7. æ›´æ–° acme.sh\"></a>7. æ›´æ–° acme.sh</h1><p>  ç›®å‰ç”±äº acme åè®®å’Œ letsencrypt CA éƒ½åœ¨é¢‘ç¹çš„æ›´æ–°, å› æ­¤ acme.sh ä¹Ÿç»å¸¸æ›´æ–°ä»¥ä¿æŒåŒæ­¥.</p>\n<p>  å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆ :</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--upgrade</span><br></code></pre></td></tr></table></figure>\n\n<p>  å¦‚æœä½ ä¸æƒ³æ‰‹åŠ¨å‡çº§, å¯ä»¥å¼€å¯è‡ªåŠ¨å‡çº§:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--upgrade</span> <span class=\"hljs-attr\">--auto-upgrade</span><br></code></pre></td></tr></table></figure>\n\n<p>  ä¹‹å, acme.sh å°±ä¼šè‡ªåŠ¨ä¿æŒæ›´æ–°äº†.</p>\n<p>  ä½ ä¹Ÿå¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°:</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--upgrade</span> <span class=\"hljs-attr\">--auto-upgrade</span>  <span class=\"hljs-number\">0</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"8-å‡ºé”™æ€ä¹ˆåŠï¼š\"><a href=\"#8-å‡ºé”™æ€ä¹ˆåŠï¼š\" class=\"headerlink\" title=\"8. å‡ºé”™æ€ä¹ˆåŠï¼š\"></a>8. å‡ºé”™æ€ä¹ˆåŠï¼š</h1><p>  å¦‚æœå‡ºé”™, è¯·æ·»åŠ  debug logï¼š</p>\n  <figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jboss-cli\">acme.sh <span class=\"hljs-params\">--issue</span>  <span class=\"hljs-string\">.....</span>  <span class=\"hljs-params\">--debug</span> <br></code></pre></td></tr></table></figure>\n\n<p>  æˆ–è€…ï¼š</p>\n  <figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jboss-cli\">acme.sh <span class=\"hljs-params\">--issue</span>  <span class=\"hljs-string\">.....</span>  <span class=\"hljs-params\">--debug</span>  2<br></code></pre></td></tr></table></figure>\n\n<p>  è¯·å‚è€ƒï¼š <a href=\"https://github.com/Neilpang/acme.sh/wiki/How-to-debug-acme.sh\">https://github.com/Neilpang/acme.sh/wiki/How-to-debug-acme.sh</a></p>\n<p>  æœ€å, æœ¬æ–‡å¹¶éå®Œå…¨çš„ä½¿ç”¨è¯´æ˜, è¿˜æœ‰å¾ˆå¤šé«˜çº§çš„åŠŸèƒ½, æ›´é«˜çº§çš„ç”¨æ³•è¯·å‚çœ‹å…¶ä»– wiki é¡µé¢.</p>\n<p>  <a href=\"https://github.com/Neilpang/acme.sh/wiki\">https://github.com/Neilpang/acme.sh/wiki</a></p>\n</blockquote>\n<h2 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">docker run --rm  -itd  \\<br>  -v &quot;$(pwd)/out&quot;:/acme.sh  \\<br>  -e Ali_Key=&quot;xxxxxx&quot; \\<br>  -e Ali_Secret=&quot;xxxx&quot; \\<br>  neilpang/acme.sh  --issue --dns dns_ali -d domain.cn -d *.domain.cn<br></code></pre></td></tr></table></figure>\n\n<p>è¯¦ç»†ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒï¼š<a href=\"https://github.com/Neilpang/acme.sh/wiki/Run-acme.sh-in-docker\">ä¼ é€é—¨</a></p>\n<blockquote>\n<h1 id=\"acme-sh-ğŸ’•-docker\"><a href=\"#acme-sh-ğŸ’•-docker\" class=\"headerlink\" title=\"acme.sh ğŸ’• docker\"></a>acme.sh ğŸ’• docker</h1><p>  ä½œä¸º docker çš„å¿ å®ç²‰ä¸ä¹‹ä¸€ï¼Œæˆ‘çŸ¥é“æˆ‘ä»¬è®¨åŒåœ¨ docker ä¸»æœºä¸Šå®‰è£…ä»»ä½•ä¸œè¥¿ï¼Œå³ä½¿å®ƒåªæ˜¯å¤åˆ¶ä¸€ä¸ª shell è„šæœ¬ã€‚</p>\n<p>  ç”¨äº letsencrypt ssl è¯ä¹¦çš„å¸¦æœ‰ acme.sh çš„è‡ªåŠ¨åŒ– nginx åå‘ä»£ç† docker å›¾åƒï¼š https: <a href=\"https://github.com/Neilpang/letsproxy\">&#x2F;&#x2F;github.com&#x2F;Neilpang&#x2F;letsproxy</a></p>\n<p>  éƒ¨ç½²åˆ° docker å®¹å™¨å¹¶é‡æ–°åŠ è½½å®ƒï¼š<a href=\"https://github.com/Neilpang/acme.sh/wiki/deploy-to-docker-containers\">https :&#x2F;&#x2F;github.com&#x2F;Neilpang&#x2F;acme.sh&#x2F;wiki&#x2F;deploy-to-docker-containers</a></p>\n<p>  æ‰€ä»¥ï¼Œè¿™é‡Œå‡ºç°äº†â€œdocker ä¸­çš„ acme.shâ€ã€‚</p>\n<ol>\n<li>åŸºäº<strong>alpine</strong>ï¼Œåªæœ‰ 5MB å¤§å°ã€‚</li>\n<li>ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæˆ–ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œ</li>\n<li>æ”¯æŒæ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°ã€‚</li>\n</ol>\n<h1 id=\"1-è¯´â€œHello-Worldâ€\"><a href=\"#1-è¯´â€œHello-Worldâ€\" class=\"headerlink\" title=\"1.è¯´â€œHello Worldâ€\"></a>1.è¯´â€œHello Worldâ€</h1>  <figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs dockerfile\">docker <span class=\"hljs-keyword\">run</span><span class=\"language-bash\"> --<span class=\"hljs-built_in\">rm</span> neilpang/acme.sh</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"2-ç”¨ä½œå¯æ‰§è¡Œæ–‡ä»¶ï¼š\"><a href=\"#2-ç”¨ä½œå¯æ‰§è¡Œæ–‡ä»¶ï¼š\" class=\"headerlink\" title=\"2.ç”¨ä½œå¯æ‰§è¡Œæ–‡ä»¶ï¼š\"></a>2.ç”¨ä½œå¯æ‰§è¡Œæ–‡ä»¶ï¼š</h1>  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">docker run <span class=\"hljs-attr\">--rm</span>  -it  \\<br>  -v <span class=\"hljs-string\">&quot;$(pwd)/out&quot;</span>:/acme<span class=\"hljs-selector-class\">.sh</span>  \\<br>  <span class=\"hljs-attr\">--net</span>=host \\<br>  neilpang/acme<span class=\"hljs-selector-class\">.sh</span>  <span class=\"hljs-attr\">--issue</span> -d example<span class=\"hljs-selector-class\">.com</span>  <span class=\"hljs-attr\">--standalone</span><br></code></pre></td></tr></table></figure>\n\n<p>  æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä½¿ç”¨<strong>acme.sh</strong>æ”¯æŒçš„<strong>ä»»ä½•å‘½ä»¤</strong>ï¼Œå…¶ä»–ç¤ºä¾‹ï¼š</p>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\"><span class=\"hljs-selector-id\">#revoke</span> <span class=\"hljs-selector-tag\">a</span> cert<br>docker run <span class=\"hljs-attr\">--rm</span>  -it  \\<br>  -v <span class=\"hljs-string\">&quot;$(pwd)/out&quot;</span>:/acme<span class=\"hljs-selector-class\">.sh</span>  \\<br>  <span class=\"hljs-attr\">--net</span>=host \\<br>  neilpang/acme<span class=\"hljs-selector-class\">.sh</span>  <span class=\"hljs-attr\">--revoke</span> -d example<span class=\"hljs-selector-class\">.com</span><br><span class=\"hljs-selector-id\">#use</span> dns mode<br>docker run <span class=\"hljs-attr\">--rm</span>  -it  \\<br>  -v <span class=\"hljs-string\">&quot;$(pwd)/out&quot;</span>:/acme<span class=\"hljs-selector-class\">.sh</span>  \\<br>  neilpang/acme<span class=\"hljs-selector-class\">.sh</span>  <span class=\"hljs-attr\">--issue</span> <span class=\"hljs-attr\">--dns</span> -d example<span class=\"hljs-selector-class\">.com</span><br><span class=\"hljs-selector-id\">#run</span> cron job<br>docker run <span class=\"hljs-attr\">--rm</span>  -it  \\<br>  -v <span class=\"hljs-string\">&quot;$(pwd)/out&quot;</span>:/acme<span class=\"hljs-selector-class\">.sh</span>  \\<br>  <span class=\"hljs-attr\">--net</span>=host \\<br>  neilpang/acme<span class=\"hljs-selector-class\">.sh</span>  <span class=\"hljs-attr\">--cron</span><br></code></pre></td></tr></table></figure>\n\n<p>  æ— è®ºå¦‚ä½•ï¼Œæ‚¨å¯ä»¥åƒè°ƒç”¨çœŸæ­£çš„ shell è„šæœ¬ä¸€æ ·è°ƒç”¨<strong>neilpang&#x2F;acme.shã€‚</strong></p>\n<h1 id=\"3-å°†-acme-sh-ä½œä¸º-docker-å®ˆæŠ¤è¿›ç¨‹è¿è¡Œã€‚\"><a href=\"#3-å°†-acme-sh-ä½œä¸º-docker-å®ˆæŠ¤è¿›ç¨‹è¿è¡Œã€‚\" class=\"headerlink\" title=\"3. å°† acme.sh ä½œä¸º docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œã€‚\"></a>3. å°† acme.sh ä½œä¸º docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œã€‚</h1><ol>\n<li>å°† acme.sh ä½œä¸º docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œä»¥ä¾¿å®ƒå¯ä»¥è‡ªåŠ¨å¤„ç†æ›´æ–° cronjobã€‚</li>\n</ol>\n  <figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">docker <span class=\"hljs-built_in\">run</span> --rm  -itd  \\<br>  -v <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$(pwd)</span>/out&quot;</span>:/acme.sh  \\<br>  <span class=\"hljs-attribute\">--net</span>=host \\<br>  <span class=\"hljs-attribute\">--name</span>=acme.sh \\<br>  neilpang/acme.sh daemon<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ç„¶åä½ å°±å¯ä»¥ä½¿ç”¨<code>docker exec</code>æ¥æ‰§è¡Œä»»ä½•acme.sh å‘½ä»¤äº†ã€‚</li>\n</ol>\n  <figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">docker  exec  acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--help</span><br>docker  exec  acme<span class=\"hljs-selector-class\">.sh</span> <span class=\"hljs-attr\">--issue</span> -d example<span class=\"hljs-selector-class\">.com</span>  <span class=\"hljs-attr\">--standalone</span><br></code></pre></td></tr></table></figure>\n\n<p>  æ˜¯çš„ï¼Œå†æ¬¡å¼ºè°ƒï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„ä½¿ç”¨<strong>acme.sh</strong>æ”¯æŒçš„<strong>ä»»ä½•å‘½ä»¤</strong>ã€‚</p>\n</blockquote>\n<h2 id=\"Certbot\"><a href=\"#Certbot\" class=\"headerlink\" title=\"Certbot\"></a>Certbot</h2><p><a href=\"https://certbot.eff.org/\">https://certbot.eff.org/</a></p>\n",
            "tags": [
                "ssl",
                "https"
            ]
        },
        {
            "id": "https://www.oikiou.top/2022/82aca4fc/",
            "url": "https://www.oikiou.top/2022/82aca4fc/",
            "title": "SSLè¯ä¹¦çš„ç”³è¯·å’Œè‡ªåŠ¨ç»­æœŸ",
            "date_published": "2022-07-21T14:57:15.000Z",
            "content_html": "<h1 id=\"SSLè¯ä¹¦çš„ç”³è¯·å’Œè‡ªåŠ¨ç»­æœŸ\"><a href=\"#SSLè¯ä¹¦çš„ç”³è¯·å’Œè‡ªåŠ¨ç»­æœŸ\" class=\"headerlink\" title=\"SSLè¯ä¹¦çš„ç”³è¯·å’Œè‡ªåŠ¨ç»­æœŸ\"></a>SSLè¯ä¹¦çš„ç”³è¯·å’Œè‡ªåŠ¨ç»­æœŸ</h1><p>Letâ€™s Encrypt è¯ä¹¦ç»­æœŸ</p>\n<h1 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h1><p><a href=\"https://www.jianshu.com/p/a2d0209fa3f5\">https://www.jianshu.com/p/a2d0209fa3f5</a></p>\n<p><a href=\"https://www.cnblogs.com/esofar/p/9291685.html\">å¿«é€Ÿç­¾å‘ Letâ€™s Encrypt è¯ä¹¦æŒ‡å—</a></p>\n<p><a href=\"https://certbot.eff.org/\">https://certbot.eff.org/</a></p>\n<h1 id=\"acme-sh-ç”³è¯·\"><a href=\"#acme-sh-ç”³è¯·\" class=\"headerlink\" title=\"acme.sh ç”³è¯·\"></a>acme.sh ç”³è¯·</h1><p>ç”¨ acme.shç”³è¯·æ¥è‡ªåŠ¨ç»­æœŸsslè¯ä¹¦<br> acmeè¯´æ˜ï¼š<a href=\"https://links.jianshu.com/go?to=https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E\">https://github.com/Neilpang/acme.sh/wiki/è¯´æ˜</a></p>\n<h2 id=\"é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå\"><a href=\"#é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå\" class=\"headerlink\" title=\"é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå\"></a>é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå</h2><ol>\n<li><p>ä¸‹è½½acme<code>curl https://get.acme.sh | sh</code>  å®‰è£…å®Œæˆåå¿…é¡»å…³é—­å½“å‰ç»ˆç«¯ï¼Œé‡æ–°å¼€å¯ä¸€ä¸ªä»¥ä½¿acme.shå‘½ä»¤ç”Ÿæ•ˆ</p>\n</li>\n<li><p>æ‰§è¡Œç”Ÿæˆå’Œè‡ªåŠ¨æ›´æ–°å‘½ä»¤ï¼š<code>acme.sh --issue -d mydomain.com -d www.mydomain.com --webroot /var/www/mydomain.com/</code></p>\n<blockquote>\n<h2 id=\"é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå-1\"><a href=\"#é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå-1\" class=\"headerlink\" title=\"é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå\"></a>é€šè¿‡åœ¨ç½‘ç«™æ ¹ç›®å½•å­˜æ”¾æ–‡ä»¶æ¥éªŒè¯åŸŸå</h2>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">acme.sh --issue -d mydomain.com -d www.mydomain.com --webroot /home/wwwroot/mydomain.com/<br><span class=\"hljs-meta prompt_\"></span><br><span class=\"hljs-meta prompt_\"># </span><span class=\"language-bash\">å¦‚æœä½ ç”¨çš„ nginxæœåŠ¡å™¨, æˆ–è€…åä»£, acme.sh è¿˜å¯ä»¥æ™ºèƒ½çš„ä» nginxçš„é…ç½®ä¸­è‡ªåŠ¨å®ŒæˆéªŒè¯, ä½ ä¸éœ€è¦æŒ‡å®šç½‘ç«™æ ¹ç›®å½•:</span><br>acme.sh --issue -d mydomain.com --nginx<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"é€šè¿‡DNSè§£ææ·»åŠ TXTè§£æè®°å½•éªŒè¯\"><a href=\"#é€šè¿‡DNSè§£ææ·»åŠ TXTè§£æè®°å½•éªŒè¯\" class=\"headerlink\" title=\"é€šè¿‡DNSè§£ææ·»åŠ TXTè§£æè®°å½•éªŒè¯\"></a>é€šè¿‡DNSè§£ææ·»åŠ TXTè§£æè®°å½•éªŒè¯</h2>  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs shell\">acme.sh --issue --dns -d mydomain.com \\<br> --yes-I-know-dns-manual-mode-enough-go-ahead-please<br><span class=\"hljs-meta prompt_\"></span><br><span class=\"hljs-meta prompt_\"># </span><span class=\"language-bash\">ç„¶å, acme.sh ä¼šç”Ÿæˆç›¸åº”çš„è§£æè®°å½•æ˜¾ç¤ºå‡ºæ¥, ä½ åªéœ€è¦åœ¨ä½ çš„åŸŸåç®¡ç†é¢æ¿ä¸­æ·»åŠ è¿™æ¡ txt è®°å½•å³å¯.ç­‰å¾…è§£æå®Œæˆä¹‹å, é‡æ–°ç”Ÿæˆè¯ä¹¦:</span><br><br>acme.sh --renew -d mydomain.com \\<br>  --yes-I-know-dns-manual-mode-enough-go-ahead-please<br><span class=\"hljs-meta prompt_\"></span><br><span class=\"hljs-meta prompt_\"># </span><span class=\"language-bash\">æ³¨æ„ç¬¬äºŒæ¬¡è¿™é‡Œç”¨çš„æ˜¯ --renew</span><br></code></pre></td></tr></table></figure>\n</blockquote>\n</li>\n<li><p>å®‰è£…è¯ä¹¦ <code>cd /etc/nginx; mkdir ssl</code></p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">acme.sh  --installcert  -d  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">domain</span>&gt;</span>.com   \\<br>        --key-file   /etc/nginx/ssl/<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">domain</span>&gt;</span>.key \\<br>        --fullchain-file /etc/nginx/ssl/fullchain.cer \\<br>        --reloadcmd  &quot;service nginx force-reload&quot;<br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>é…ç½®nginxä½¿ç”¨ssl</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">server &#123;<br>    listen 80 default_server;<br>    listen 443 http2 ssl;<br>    listen [::]:80 default_server;<br><br>    ssl_certificate /etc/nginx/ssl/fullchain.cer;<br>    ssl_certificate_key /etc/nginx/ssl/domain.key;<br>    <span class=\"hljs-comment\">#httpè½¬https</span><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$scheme</span> = http ) &#123;<span class=\"hljs-built_in\">return</span> 301 https://$host<span class=\"hljs-variable\">$request_uri</span>;&#125;<br>    root /var/www/html;<br><br>    index index.html index.htm index.nginx-debian.html;<br>    server_name _;<br><br>    ssl_certificate /etc/nginx/ssl/fullchain.cer;<br>    ssl_certificate_key /etc/nginx/ssl/domain.key;<br><br>    location /test &#123;<br>          proxy_pass       http://127.0.0.1:3000;<br>          proxy_http_version 1.1;<br>          proxy_set_header Upgrade <span class=\"hljs-variable\">$http_upgrade</span>;<br>          proxy_set_header Connection <span class=\"hljs-string\">&quot;upgrade&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>å‰ç«¯çš„Upgradeè¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨ï¼ŒUpgradeå’ŒConnectionçš„å¤´ä¿¡æ¯å¿…é¡»è¢«æ˜¾å¼çš„è®¾ç½®ã€‚ä¸€æ—¦æˆ‘ä»¬å®Œæˆä»¥ä¸Šè®¾ç½®ï¼ŒNGINXå°±å¯ä»¥å¤„ç†WebSocketè¿æ¥äº†ã€‚æŸ¥çœ‹é…ç½®åœ¨å“ªé‡Œ<code>ps -ef|grep nginx</code><br> å¤šä¸ªåŸŸåçš„è¯ï¼Œé…å¤šä¸ªnginx.confé…ç½®ã€‚</p>\n<ol start=\"5\">\n<li>æŸ¥çœ‹æ˜¯å¦æœ‰æ¯æ—¥ä»»åŠ¡<br> <code>crontab -l #æŸ¥çœ‹ä½ çš„ä»»åŠ¡</code><br> æ‰‹åŠ¨æ›´æ–°è¯ä¹¦<code>acme.sh --renew -d domain.com</code></li>\n</ol>\n<h1 id=\"certbot\"><a href=\"#certbot\" class=\"headerlink\" title=\"certbot\"></a>certbot</h1><p><a href=\"https://certbot.eff.org/\">æ–‡æ¡£</a></p>\n<p>Ubuntu + nginx <a href=\"https://certbot.eff.org/instructions?ws=nginx&os=ubuntufocal\">https://certbot.eff.org/instructions?ws=nginx&amp;os=ubuntufocal</a></p>\n<p>ç”¨certbotæ¥è‡ªåŠ¨ç»­æœŸsslè¯ä¹¦</p>\n<ul>\n<li>éœ€è¦æ³¨æ„çš„æ˜¯å®‰è£…è¯ä¹¦çš„æ—¶å€™æœ€å¥½æŠŠnginxå…³æ‰å…ˆ</li>\n</ul>\n",
            "tags": [
                "ssl",
                "https"
            ]
        },
        {
            "id": "https://www.oikiou.top/2022/aa858de8/",
            "url": "https://www.oikiou.top/2022/aa858de8/",
            "title": "Wordpress",
            "date_published": "2022-02-21T14:57:15.000Z",
            "content_html": "<h1 id=\"Wordpress\"><a href=\"#Wordpress\" class=\"headerlink\" title=\"Wordpress\"></a>Wordpress</h1><h2 id=\"LNMPå®‰è£…\"><a href=\"#LNMPå®‰è£…\" class=\"headerlink\" title=\"LNMPå®‰è£…\"></a>LNMPå®‰è£…</h2><p><a href=\"https://lnmp.org/\">https://lnmp.org/</a></p>\n<p><strong>LNMPä¸€é”®å®‰è£…åŒ…æ˜¯ä»€ä¹ˆ?</strong></p>\n<p>LNMPä¸€é”®å®‰è£…åŒ…æ˜¯ä¸€ä¸ªç”¨Linux Shellç¼–å†™çš„å¯ä»¥ä¸ºCentOS&#x2F;RHEL&#x2F;Fedora&#x2F;Aliyun&#x2F;Amazonã€Debian&#x2F;Ubuntu&#x2F;Raspbian&#x2F;Deepin&#x2F;Mint Linux VPSæˆ–ç‹¬ç«‹ä¸»æœºå®‰è£…LNMP(Nginx&#x2F;MySQL&#x2F;PHP)ã€LNMPA(Nginx&#x2F;MySQL&#x2F;PHP&#x2F;Apache)ã€LAMP(Apache&#x2F;MySQL&#x2F;PHP)ç”Ÿäº§ç¯å¢ƒçš„Shellç¨‹åºã€‚</p>\n<h3 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># ç™»å½•</span><br>mysql -u root -p<br><br><span class=\"hljs-comment\"># å¦‚æœæŠ¥æ‰¾ä¸åˆ°å‘½ä»¤ cdåˆ°å¯¹åº”ç›®å½•å»ç™»å½•</span><br><span class=\"hljs-built_in\">cd</span> /usr/local/mariadb10/bin/<br>./mysql -u root -p<br><br><span class=\"hljs-comment\"># åˆ‡æ¢åˆ°mysqlæ•°æ®åº“</span><br>use mysql<br><br><span class=\"hljs-comment\"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»º MariaDB æ•°æ®åº“ã€‚ä¾‹å¦‚ â€œwordpressâ€ã€‚</span><br>CREATE DATABASE IF NOT EXISTS wordpress;<br><br><span class=\"hljs-comment\"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ã€‚ä¾‹å¦‚ â€œuserâ€ï¼Œç™»å½•å¯†ç ä¸º 123456ã€‚</span><br>CREATE USER <span class=\"hljs-string\">&#x27;user&#x27;</span>@<span class=\"hljs-string\">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class=\"hljs-string\">&#x27;123456&#x27;</span>;<br><br><span class=\"hljs-comment\"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œèµ‹äºˆç”¨æˆ·å¯¹ â€œwordpressâ€ æ•°æ®åº“çš„å…¨éƒ¨æƒé™ã€‚</span><br>GRANT ALL PRIVILEGES ON wordpress.* TO <span class=\"hljs-string\">&#x27;user&#x27;</span>@<span class=\"hljs-string\">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class=\"hljs-string\">&#x27;123456&#x27;</span>;<br><br><span class=\"hljs-comment\"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè®¾ç½® root å¸æˆ·å¯†ç </span><br>ALTER USER root@localhost IDENTIFIED VIA mysql_native_password USING PASSWORD(<span class=\"hljs-string\">&#x27;è¾“å…¥æ‚¨çš„å¯†ç &#x27;</span>);<br><br><span class=\"hljs-comment\"># æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½¿æ‰€æœ‰é…ç½®ç”Ÿæ•ˆã€‚</span><br>FLUSH PRIVILEGES;<br><br><span class=\"hljs-comment\"># é€€å‡º</span><br>\\q<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"Wordpress-1\"><a href=\"#Wordpress-1\" class=\"headerlink\" title=\"Wordpress\"></a>Wordpress</h2><h4 id=\"ä¿®æ”¹-WordPress-é…ç½®æ–‡ä»¶\"><a href=\"#ä¿®æ”¹-WordPress-é…ç½®æ–‡ä»¶\" class=\"headerlink\" title=\"ä¿®æ”¹ WordPress é…ç½®æ–‡ä»¶\"></a>ä¿®æ”¹ WordPress é…ç½®æ–‡ä»¶</h4><ol>\n<li><p>ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿›å…¥ WordPress å®‰è£…ç›®å½•ï¼Œå°†<code>wp-config-sample.php</code>æ–‡ä»¶å¤åˆ¶åˆ°<code>wp-config.php</code>æ–‡ä»¶ä¸­ï¼Œå¹¶å°†åŸå…ˆçš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ä¿ç•™ä½œä¸ºå¤‡ä»½ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cd</span> /home/wwwroot/wordpress<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\"><span class=\"hljs-keyword\">cp</span> <span class=\"hljs-keyword\">wp</span>-config-sample.php <span class=\"hljs-keyword\">wp</span>-config.php<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰“å¼€å¹¶ç¼–è¾‘æ–°åˆ›å»ºçš„é…ç½®æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs vim\"><span class=\"hljs-keyword\">vim</span> <span class=\"hljs-keyword\">wp</span>-config.php<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>æŒ‰ <strong>i</strong> åˆ‡æ¢è‡³ç¼–è¾‘æ¨¡å¼ï¼Œæ‰¾åˆ°æ–‡ä»¶ä¸­ MySQL çš„éƒ¨åˆ†ï¼Œå¹¶å°†ç›¸å…³é…ç½®ä¿¡æ¯ä¿®æ”¹ä¸º <a href=\"https://cloud.tencent.com/document/product/213/8044#database\">é…ç½® WordPress æ•°æ®åº“</a> ä¸­çš„å†…å®¹ã€‚</p>\n<figure class=\"highlight lasso\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lasso\"><span class=\"hljs-comment\">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class=\"hljs-comment\">/** The name of the database for WordPress */</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">define</span></span>(<span class=\"hljs-string\">&#x27;DB_NAME&#x27;</span>, <span class=\"hljs-string\">&#x27;wordpress&#x27;</span>);<br>    <br><span class=\"hljs-comment\">/** MySQL database username */</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">define</span></span>(<span class=\"hljs-string\">&#x27;DB_USER&#x27;</span>, <span class=\"hljs-string\">&#x27;user&#x27;</span>);<br>    <br><span class=\"hljs-comment\">/** MySQL database password */</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">define</span></span>(<span class=\"hljs-string\">&#x27;DB_PASSWORD&#x27;</span>, <span class=\"hljs-string\">&#x27;123456&#x27;</span>);<br>    <br><span class=\"hljs-comment\">/** MySQL hostname */</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">define</span></span>(<span class=\"hljs-string\">&#x27;DB_HOST&#x27;</span>, <span class=\"hljs-string\">&#x27;localhost&#x27;</span>);<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>ä¿®æ”¹å®Œæˆåï¼ŒæŒ‰ <strong>Esc</strong>ï¼Œè¾“å…¥ <strong>:wq</strong>ï¼Œä¿å­˜æ–‡ä»¶è¿”å›ã€‚</p>\n</li>\n</ol>\n<h3 id=\"å¼€å¯HTTPSæ”¯æŒ\"><a href=\"#å¼€å¯HTTPSæ”¯æŒ\" class=\"headerlink\" title=\"å¼€å¯HTTPSæ”¯æŒ\"></a>å¼€å¯HTTPSæ”¯æŒ</h3><h1 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h1><h2 id=\"è·å–åŸŸå\"><a href=\"#è·å–åŸŸå\" class=\"headerlink\" title=\"è·å–åŸŸå\"></a>è·å–åŸŸå</h2><p>è¿™é‡Œæœ‰ä¸€ä¸ªå…è´¹çš„åŸŸå, å…ˆå‡‘åˆç”¨ç€å§</p>\n<p><a href=\"https://www.freenom.com/\">https://www.freenom.com/</a></p>\n<blockquote>\n<p>  freenom æ³¨å†Œæ–¹æ³•</p>\n<p>  <a href=\"https://zhuanlan.zhihu.com/p/115535965\">https://zhuanlan.zhihu.com/p/115535965</a></p>\n<p>  Freenomå¸¸è§é—®é¢˜è§£å†³æ–¹æ³•</p>\n<p>  <a href=\"http://www.360doc.com/content/21/0124/00/30583588_958609144.shtml\">http://www.360doc.com/content/21/0124/00/30583588_958609144.shtml</a></p>\n</blockquote>\n<ul>\n<li><p>æ³¨å†Œçš„æ—¶å€™æœç´¢è¦åŠ ä¸Šåç¼€ä¸ç„¶ä¼šæ˜¾ç¤º  ä¸å¯ç”¨</p>\n</li>\n<li><p>checkout åˆ°è´­ç‰©è½¦æ”¹æˆ 12æœˆ free</p>\n</li>\n<li><p>è°·æ­Œé‚®ç®±ç›´æ¥ç™»å½• ç™»å½•åè¦æ›´æ”¹è‡ªå·±çš„ä¸ªäººä¿¡æ¯é‡Œé¢çš„åœ°å€(æ”¹æˆipæ‰€åœ¨åœ°) ä¸ç„¶æ— æ³•æˆåŠŸæ³¨å†Œ</p>\n</li>\n<li><p>èœå•æ  servers -&gt; my domains å°±å¯ä»¥çœ‹åˆ°åœ°å€äº†</p>\n</li>\n<li><p>æœ€åå†ä¿®æ”¹ä¸€ä¸‹NSæœåŠ¡å™¨</p>\n<ul>\n<li><p>Manage Domain -&gt; Management Tools -&gt; nameserver -&gt; Use custom nameservers (enter below)</p>\n</li>\n<li><p>è¿™é‡Œå¡«å†™cloudflare æˆ–è€… dnspod ç»™å‡ºæ¥çš„ Nameservers å°±å¥½äº†</p>\n</li>\n<li><p>ç±»ä¼¼äº</p>\n</li>\n<li><table>\n<thead>\n<tr>\n<th align=\"left\">Type</th>\n<th align=\"left\">Value</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">NS</td>\n<td align=\"left\">katja.ns.cloudflare.com</td>\n</tr>\n<tr>\n<td align=\"left\">NS</td>\n<td align=\"left\">kirk.ns.cloudflare.com</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"åŸŸåè§£æ\"><a href=\"#åŸŸåè§£æ\" class=\"headerlink\" title=\"åŸŸåè§£æ\"></a>åŸŸåè§£æ</h2><p>åŸŸåçš„<a href=\"https://www.vpsgo.com/tag/ns%E8%AE%B0%E5%BD%95\">NSè®°å½•</a>ï¼ˆ<a href=\"https://www.vpsgo.com/tag/name-server\">Name Server</a>ï¼‰æ˜¯æŒ‡å¤„ç†åŸŸåè§£æçš„æœåŠ¡å™¨ï¼Œè¯´ç™½ç‚¹å°±æ˜¯ä½ çš„åŸŸåç”±è°å®¶æ¥è§£æã€‚ä¸€èˆ¬è´­ä¹°äº†åŸŸååï¼Œé»˜è®¤çš„NSè®°å½•å°±æ˜¯æŒ‡å‘åŸŸåæä¾›å•†çš„ï¼ˆä¾‹å¦‚NameSiloçš„é»˜è®¤å°±ç”±å®ƒè‡ªå·±è§£æï¼‰ã€‚ä½ å¯ä»¥ä¿®æ”¹åŸŸåçš„NSè®°å½•ï¼Œè®©å®ƒç”±ä¸åŒçš„è§£ææœåŠ¡å•†æ¥è§£æï¼Œä¾‹å¦‚å¯ä»¥æŒ‡å‘<a href=\"https://www.vpsgo.com/tag/cloudflare\">Cloudflare</a>æˆ–è€…<a href=\"https://www.vpsgo.com/tag/dnspod\">DNSPod</a>ã€‚</p>\n<p>ä¹‹åDNSï¼ˆDomain Name Systemï¼‰ï¼Œå¸¸ç”¨çš„<a href=\"https://www.vpsgo.com/tag/dns%E8%AE%B0%E5%BD%95\">DNSè®°å½•</a>åŒ…æ‹¬åŸŸåè§£æä¸­Aè®°å½•ã€CNAMEã€MXè®°å½•ã€‚<a href=\"https://www.vpsgo.com/tag/%E5%9F%9F%E5%90%8Da%E8%AE%B0%E5%BD%95\">åŸŸåAè®°å½•</a>åˆç§°ä¸ºIPæŒ‡å‘ï¼Œå°±æ˜¯è¯´ä½ è¿™ä¸ªåŸŸåä»£è¡¨ä»€ä¹ˆIPï¼›åŸŸåCNAMEæ˜¯æŒ‡åˆ«åæŒ‡å‘ï¼Œå°±æ˜¯è¯´æŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼Œä¾‹å¦‚å¯ä»¥è®¾ç½®test.vpsgo.comæŒ‡å‘<a href=\"http://www.vpsgo.com;åŸŸåçš„mxè®°å½•å°±æ˜¯é‚®ä»¶äº¤æ¢è®°å½•,æ˜¯åšé‚®ä»¶æœåŠ¡å™¨éœ€è¦è®¾ç½®çš„.æœ¬æ–‡ä¸»è¦ä»‹ç»åŸŸåaè®°å½•è§£æ./\">www.vpsgo.comï¼›åŸŸåçš„MXè®°å½•å°±æ˜¯é‚®ä»¶äº¤æ¢è®°å½•ï¼Œæ˜¯åšé‚®ä»¶æœåŠ¡å™¨éœ€è¦è®¾ç½®çš„ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»åŸŸåAè®°å½•è§£æã€‚</a></p>\n<blockquote>\n<p>  cloudflare è§£æ</p>\n<p>  <a href=\"https://zhuanlan.zhihu.com/p/56423186\">https://zhuanlan.zhihu.com/p/56423186</a></p>\n<p>  <a href=\"https://www.vpsgo.com/domain-ns-cloudflare-dnspod.html#NS\">https://www.vpsgo.com/domain-ns-cloudflare-dnspod.html#NS</a></p>\n</blockquote>\n<h1 id=\"HTTPS-SSL-TLS\"><a href=\"#HTTPS-SSL-TLS\" class=\"headerlink\" title=\"HTTPS SSL&#x2F;TLS\"></a>HTTPS SSL&#x2F;TLS</h1><h2 id=\"å‚è€ƒæ–‡ç« \"><a href=\"#å‚è€ƒæ–‡ç« \" class=\"headerlink\" title=\"å‚è€ƒæ–‡ç« \"></a>å‚è€ƒæ–‡ç« </h2><h3 id=\"acme-sh\"><a href=\"#acme-sh\" class=\"headerlink\" title=\"acme.sh\"></a>acme.sh</h3><p><a href=\"https://ruby-china.org/topics/31983\">https://ruby-china.org/topics/31983</a></p>\n<p><a href=\"https://ruby-china.org/topics/28471\">https://ruby-china.org/topics/28471</a></p>\n<p><a href=\"https://ruby-china.org/topics/25543\">https://ruby-china.org/topics/25543</a></p>\n<p><a href=\"https://ruby-china.org/topics/31942\">https://ruby-china.org/topics/31942</a></p>\n<h3 id=\"caddy\"><a href=\"#caddy\" class=\"headerlink\" title=\"caddy\"></a>caddy</h3><p><a href=\"https://caddyserver.com/docs/quick-starts/https\">https://caddyserver.com/docs/quick-starts/https</a></p>\n<h2 id=\"æ­¥éª¤\"><a href=\"#æ­¥éª¤\" class=\"headerlink\" title=\"æ­¥éª¤\"></a>æ­¥éª¤</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># å®‰è£… acme.sh</span><br>curl https://get.acme.sh | sh<br><br><span class=\"hljs-comment\"># ç„¶åé‡æ–°è½½å…¥ä¸€ä¸‹ .bashrc</span><br><span class=\"hljs-built_in\">source</span> ~/.bashrc <br><br><span class=\"hljs-comment\"># è‡³æ­¤acmeå®‰è£…å®Œæˆ</span><br>acme.sh<br></code></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># æ³¨å†Œè´¦å·</span><br><span class=\"hljs-built_in\">sudo</span> ~/.acme.sh/acme.sh --register-account -m jackliuworkemail@gmail.com  --server zerossl<br><br><span class=\"hljs-comment\"># ä¸ºlager.cfåˆ›å»ºå¯†é’¥</span><br><span class=\"hljs-comment\"># -k è¡¨ç¤ºå¯†é’¥é•¿åº¦ï¼Œåé¢çš„å€¼å¯ä»¥æ˜¯ ec-256 ã€ec-384ã€2048ã€3072ã€4096ã€8192ï¼Œå¸¦æœ‰ ec è¡¨ç¤ºç”Ÿæˆçš„æ˜¯ ECC è¯ä¹¦ï¼Œæ²¡æœ‰åˆ™æ˜¯ RSA è¯ä¹¦ã€‚åœ¨å®‰å…¨æ€§ä¸Š 256 ä½çš„ ECC è¯ä¹¦ç­‰åŒäº 3072 ä½çš„ RSA è¯ä¹¦ã€‚</span><br><span class=\"hljs-built_in\">sudo</span> ~/.acme.sh/acme.sh --issue -d lager.cf --standalone -k ec-256<br><br><span class=\"hljs-comment\"># ç”±äº Let&#x27;s Encrypt çš„è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ 3 ä¸ªæœˆï¼Œå› æ­¤éœ€è¦ 90 å¤©è‡³å°‘è¦æ›´æ–°ä¸€æ¬¡è¯ä¹¦ï¼Œacme.sh è„šæœ¬ä¼šæ¯ 60 å¤©è‡ªåŠ¨æ›´æ–°è¯ä¹¦ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ›´æ–°ã€‚</span><br><span class=\"hljs-comment\"># æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡</span><br> crontab -l<br><span class=\"hljs-comment\"># æ‰‹åŠ¨æ›´æ–° ECC è¯ä¹¦ï¼Œæ‰§è¡Œï¼š</span><br><span class=\"hljs-built_in\">sudo</span> ~/.acme.sh/acme.sh --renew -d lager.cf --force --ecc<br><br><span class=\"hljs-comment\"># è¯·æ³¨æ„ï¼šreloadcmdéå¸¸é‡è¦ã€‚è¯ä¹¦å¯ä»¥è‡ªåŠ¨ç»­è®¢ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®çš„â€œreloadcmdâ€ï¼Œè¯ä¹¦å¯èƒ½æ— æ³•åˆ·æ–°åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼ˆå¦‚nginxæˆ–apacheï¼‰ï¼Œé‚£ä¹ˆæ‚¨çš„ç½‘ç«™å°†æ— æ³•åœ¨60å¤©å†…æ˜¾ç¤ºç»­è®¢è¯ä¹¦ã€‚</span><br><span class=\"hljs-comment\"># æ³¨æ„ï¼šæ— è®ºä»€ä¹ˆæƒ…å†µï¼Œå¯†é’¥(å³ä¸Šé¢çš„lager.cf.key)éƒ½ä¸èƒ½æ³„æ¼ï¼Œå¦‚æœä½ ä¸å¹¸æ³„æ¼äº†å¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨ acme.sh å°†åŸè¯ä¹¦åŠé”€ï¼Œå†ç”Ÿæˆæ–°çš„è¯ä¹¦ï¼ŒåŠé”€æ–¹æ³•è¯·è‡ªè¡Œå‚è€ƒ acme.sh çš„æ‰‹å†Œ</span><br>acme.sh --installcert -d lager.cf \\<br>--keypath       /usr/local/nginx/ssl/lager.cf.key \\<br>--fullchainpath /usr/local/nginx/ssl/lager.cf.cer \\<br>--reloadcmd     <span class=\"hljs-string\">&quot;sudo service nginx force-reload&quot;</span>  --force --ecc<br><br><span class=\"hljs-comment\"># ç”Ÿæˆ dhparam.pem æ–‡ä»¶</span><br>openssl dhparam -out /usr/local/nginx/ssl/lager.cf.pem 2048<br><br><br><span class=\"hljs-comment\"># é…ç½®nginx å¯ç”¨ https</span><br>vim /usr/local/nginx/conf/nginx.conf<br><br><span class=\"hljs-comment\"># æ£€æŸ¥é…ç½®</span><br><span class=\"hljs-built_in\">sudo</span> service nginx configtest<br><span class=\"hljs-comment\"># é‡å¯æœåŠ¡</span><br><span class=\"hljs-built_in\">sudo</span> service nginx restart<br><br><br><span class=\"hljs-comment\">#éªŒè¯ SSL</span><br><span class=\"hljs-comment\">#è®¿é—® ssllabs.com è¾“å…¥ä½ çš„åŸŸåï¼Œæ£€æŸ¥ SSL çš„é…ç½®æ˜¯å¦éƒ½æ­£å¸¸ï¼š</span><br>https://ssllabs.com/ssltest/analyze.html?d=ruby-china.org<br></code></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"ä¸€äº›æ³¨æ„äº‹é¡¹\"><a href=\"#ä¸€äº›æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"ä¸€äº›æ³¨æ„äº‹é¡¹\"></a>ä¸€äº›æ³¨æ„äº‹é¡¹</h3><ul>\n<li><code>ssl_dhparam</code> æœªé…ç½®ï¼Œå°†å¯¼è‡´ ssllabs.com çš„è¯„åˆ†é™åˆ° Bï¼Œå¹¶ç»™ <code>This server supports weak Diffie-Hellman (DH) key exchange parameters. Grade capped to B.</code> çš„è­¦å‘Šã€‚</li>\n<li><code>ssl_prefer_server_ciphers on</code> ä¹Ÿæ˜¯ä¸€ä¸ªå¿…è¦çš„é…ç½®ï¼Œå¦åˆ™ä¼š A+ å˜æˆ A-;</li>\n<li>å¦‚æœä½ éœ€è¦å…¼å®¹è€ç³»ç»Ÿæˆ–è€æµè§ˆå™¨çš„è¯ï¼Œä½ éœ€è¦é…ç½® <code>ssl_ciphers</code>ï¼Œè¯¦è§ <a href=\"https://wiki.mozilla.org/Security/Server_Side_TLS\">Mozilla Server_Side_TLS çš„ä»‹ç»</a>ï¼ŒNginx é‡Œé¢ <code>ssl_ciphers</code> é»˜è®¤å€¼æ˜¯ <code>HIGH:!aNULL:!MD5;</code> <a href=\"https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_ciphers\">ref</a></li>\n</ul>\n<h2 id=\"acme-sh-1\"><a href=\"#acme-sh-1\" class=\"headerlink\" title=\"acme.sh\"></a>acme.sh</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># æŸ¥çœ‹è¯ä¹¦åˆ—è¡¨</span><br>acme.sh --list<br><br><span class=\"hljs-comment\"># åˆ é™¤è¯ä¹¦</span><br>acme.sh remove Main_Domain (è¯ä¹¦çš„ä¸»åŸŸåï¼Œä¸Šè¿°è¯ä¹¦åˆ—è¡¨ä¸­å¯çœ‹è§)<br><br><span class=\"hljs-comment\"># å‡çº§ acme.sh åˆ°æœ€æ–°ç‰ˆ :</span><br>acme.sh --upgrade<br><br><span class=\"hljs-comment\"># å¦‚æœä½ ä¸æƒ³æ‰‹åŠ¨å‡çº§, å¯ä»¥å¼€å¯è‡ªåŠ¨å‡çº§:</span><br>acme.sh --upgrade --auto-upgrade<br><br><span class=\"hljs-comment\">#ä½ ä¹Ÿå¯ä»¥éšæ—¶å…³é—­è‡ªåŠ¨æ›´æ–°:</span><br>acme.sh --upgrade --auto-upgrade 0 <br><br><span class=\"hljs-comment\"># å¦‚æœå‡ºé”™, è¯·æ·»åŠ  debug logï¼š</span><br>acme.sh --issue ..... --debug <br><span class=\"hljs-comment\"># æˆ–è€…ï¼š</span><br>acme.sh --issue ..... --debug 2<br></code></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n<h2 id=\"ngix\"><a href=\"#ngix\" class=\"headerlink\" title=\"ngix\"></a>ngix</h2><h3 id=\"nginx-config-1\"><a href=\"#nginx-config-1\" class=\"headerlink\" title=\"nginx config 1\"></a>nginx config 1</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">server &#123;<br>    listen 80; <span class=\"hljs-comment\">#å¦‚æœç¡¬æ€§è¦æ±‚å…¨éƒ¨èµ°httpsåè®®ï¼Œè¿™ä¸€è¡Œå»é™¤</span><br>    listen 443 ssl http2; <span class=\"hljs-comment\">#å¦‚æœç¡¬æ€§è¦æ±‚å…¨éƒ¨èµ°httpsåè®®ï¼Œè¿™é‡Œå»é™¤ssl</span><br>    server_name chandao.test.com;<br><br>    ssl_certificate /usr/local/nginx/ssl_cert/test.com/chandao.test.com.cer;<br>    ssl_certificate_key /usr/local/nginx/ssl_cert/test.com/chandao.test.com.key;<br>    ssl_dhparam /usr/local/nginx/ssl/lager.cf.pem;<br><br>    <span class=\"hljs-comment\">#sslæ€§èƒ½è°ƒä¼˜</span><br>    <span class=\"hljs-comment\">#nginx 1.13.0æ”¯æŒäº†TLSv1.3,TLSv1.3ç›¸æ¯”ä¹‹å‰çš„TLSv1.2ã€TLSv1.1ç­‰æ€§èƒ½å¤§å¹…æå‡</span><br>    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br>    <span class=\"hljs-comment\"># ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br>    <span class=\"hljs-comment\"># ssl_prefer_server_ciphers on|off ä½œç”¨ï¼šæ˜¯å¦ç”±æœåŠ¡å™¨å†³å®šé‡‡ç”¨å“ªç§åŠ å¯†ç®—æ³•</span><br>    <span class=\"hljs-comment\"># å¦‚æœsslåè®®æ”¯æŒtlsv1 tls1.1è¿™ç§è€åè®®ï¼Œè®¾ç½®ä¸º on ï¼Œå¹¶é…åˆssl_ciphersä½¿ç”¨</span><br>    <span class=\"hljs-comment\"># å¦‚æœsslåè®®åªæ”¯æŒtlsv1.2 tlsv1.3æ–°åè®®ï¼Œè®¾ç½®ä¸º off ï¼ˆnginxé»˜è®¤ä¸ºoffï¼‰ï¼Œå› ä¸ºæ–°åè®®ä¸å†é‡‡çº³æ­¤å‚æ•°</span><br>    ssl_prefer_server_ciphers on;<br>    ssl_session_timeout 10m;<br>    <span class=\"hljs-comment\">#ä½¿ç”¨ssl_session_cacheä¼˜åŒ–httpsä¸‹Nginxçš„æ€§èƒ½</span><br>    ssl_session_cache <span class=\"hljs-built_in\">builtin</span>:1000 shared:SSL:10m;<br>    <span class=\"hljs-comment\">#OCSP Stapling å¼€å¯ã€‚OCSPæ˜¯ç”¨äºåœ¨çº¿æŸ¥è¯¢è¯ä¹¦åŠé”€æƒ…å†µçš„æœåŠ¡ï¼Œä½¿ç”¨OCSP Staplingèƒ½å°†è¯ä¹¦æœ‰æ•ˆçŠ¶æ€çš„ä¿¡æ¯ç¼“å­˜åˆ°æœåŠ¡å™¨ï¼Œæé«˜ TLS æ¡æ‰‹é€Ÿåº¦</span><br>    ssl_stapling on;<br>    <span class=\"hljs-comment\">#OCSP Stapling éªŒè¯å¼€å¯</span><br>    ssl_stapling_verify on;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-config-2\"><a href=\"#nginx-config-2\" class=\"headerlink\" title=\"nginx config 2\"></a>nginx config 2</h3><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">http</span> &#123;<br>  <span class=\"hljs-comment\"># æ–°å¢</span><br>  <span class=\"hljs-attribute\">ssl_protocols</span> TLSv1 TLSv1.<span class=\"hljs-number\">1</span> TLSv1.<span class=\"hljs-number\">2</span>;<br>  <span class=\"hljs-attribute\">ssl_prefer_server_ciphers</span> <span class=\"hljs-literal\">on</span>;<br>  <span class=\"hljs-comment\"># å…¼å®¹å…¶ä»–è€æµè§ˆå™¨çš„ ssl_ciphers è®¾ç½®è¯·è®¿é—® https://wiki.mozilla.org/Security/Server_Side_TLS</span><br><br>  <span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span> default_server;<br>    <span class=\"hljs-comment\"># æ–°å¢</span><br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">443</span> ssl;<br>    <span class=\"hljs-attribute\">ssl_certificate</span>         /home/ubuntu/www/ssl/www.your-app.com.key.pem;<br>    <span class=\"hljs-attribute\">ssl_certificate_key</span>     /home/ubuntu/www/ssl/www.your-app.com.key;<br>    <span class=\"hljs-comment\"># ssl_dhparam </span><br>    <span class=\"hljs-attribute\">ssl_dhparam</span>             /home/ubuntu/www/ssl/dhparam.pem;<br><br>    <span class=\"hljs-comment\"># å…¶ä»–çœç•¥</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n<p>80 é‡å®šå‘åˆ° 443</p>\n<p>è¿™äº›åŠæ³•è¯•äº†å¥½å¤šæ¬¡éƒ½ä¸å¤ªè¡Œ</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">server &#123;<br>  listen       80 default_server;<br>  server_name  www.lager.cf;<br>  <span class=\"hljs-built_in\">return</span> 301 https://$server_name<span class=\"hljs-variable\">$request_uri</span>;<br>&#125;<br><br><br>server &#123;<br>    listen      80;<br>    server_name    www.awesomes.cn,awesomes.cn;<br>    rewrite ^(.*)$  https://$host<span class=\"hljs-variable\">$1</span> permanent;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"v2ray-tls-websocket-æµé‡ä¼ªè£…\"><a href=\"#v2ray-tls-websocket-æµé‡ä¼ªè£…\" class=\"headerlink\" title=\"v2ray + tls + websocket æµé‡ä¼ªè£…\"></a>v2ray + tls + websocket æµé‡ä¼ªè£…</h1><p><a href=\"https://www.bwgss.org/616.html\">https://www.bwgss.org/616.html</a></p>\n<h1 id=\"é™„å½•\"><a href=\"#é™„å½•\" class=\"headerlink\" title=\"é™„å½•\"></a>é™„å½•</h1><ol>\n<li><p>è¯ä¹¦(Certificate) â€“ *.cer *.crt</p>\n</li>\n<li><p>ç§é’¥(Private Key) â€“ *.key</p>\n</li>\n<li><p>è¯ä¹¦ç­¾åè¯·æ±‚(Certificate signing request) â€“ *.csr</p>\n</li>\n<li><p>ç¼–ç æ–¹å¼: 1. pem - base64ç¼–ç  2. der - äºŒè¿›åˆ¶ç¼–ç (å°‘è§), cer,key,csr å‡å¯ç”¨è¿™ä¸¤ç§ç¼–ç æ–¹å¼</p>\n</li>\n<li><p>è¯ä¹¦åŠé”€åˆ—è¡¨(Certificate Revocation List) â€“ *.crl</p>\n</li>\n<li><p>jksï¼ˆjavakeystoneï¼‰â€” æ˜¯JAVAçš„keytoolsè¯ä¹¦å·¥å…·æ”¯æŒçš„è¯ä¹¦ç§é’¥æ ¼å¼ï¼Œjavakeystone é‡Œé¢å­˜æ”¾ç€keyå’Œä¿¡ä»»çš„CAï¼Œkeyå’ŒCAå¯ä»¥æœ‰å¤šä¸ªã€‚</p>\n</li>\n</ol>\n<p><img src=\"/2022/aa858de8/1606053801673.png\" alt=\"Wordpress\"></p>\n",
            "tags": [
                "web",
                "ssl",
                "https",
                "wordpress",
                "mysql",
                "nginx"
            ]
        }
    ]
}