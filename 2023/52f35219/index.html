<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.webp"><link rel="icon" href="/img/favicon.webp"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="Oikiou"><meta name="keywords" content=""><meta name="description" content="ProxmoxVE一些前置知识qcow2 raw vmdk 磁盘格式的区别KVM 虚拟化中使用的镜像格式通常为 RAW 和 QCOW2 两种格式.  RAW (img)  RAW 的原意是「未被加工的」, 所以 RAW 格式镜像文件又被称为 原始镜像 或 裸设备镜像, 从这些称谓可以看出, RAW 格式镜像文件能够直接当作一个块设备, 以供 GuestOS 使用. 也就是说 KVM 的 Guest"><meta property="og:type" content="article"><meta property="og:title" content="ProxmoxVE"><meta property="og:url" content="https://www.oikiou.top/2023/52f35219/index.html"><meta property="og:site_name" content="Oikiou&#39;s Blog"><meta property="og:description" content="ProxmoxVE一些前置知识qcow2 raw vmdk 磁盘格式的区别KVM 虚拟化中使用的镜像格式通常为 RAW 和 QCOW2 两种格式.  RAW (img)  RAW 的原意是「未被加工的」, 所以 RAW 格式镜像文件又被称为 原始镜像 或 裸设备镜像, 从这些称谓可以看出, RAW 格式镜像文件能够直接当作一个块设备, 以供 GuestOS 使用. 也就是说 KVM 的 Guest"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.oikiou.top/2023/52f35219/bus-types-table.png"><meta property="og:image" content="https://www.oikiou.top/2023/52f35219/image-41.png"><meta property="og:image" content="https://www.oikiou.top/2023/52f35219/2983653-20221011173336293-1137047342.png"><meta property="og:image" content="https://www.oikiou.top/2023/52f35219/2983653-20221011173352327-326543372.png"><meta property="og:image" content="https://www.oikiou.top/ProxmoxVE.assets/image-20240626174453544.png"><meta property="og:image" content="https://www.oikiou.top/2023/52f35219/image-20240729150809676.png"><meta property="og:image" content="https://www.oikiou.top/2023/52f35219/image-20240729150802776.png"><meta property="article:published_time" content="2023-08-24T14:57:15.000Z"><meta property="article:modified_time" content="2024-08-07T09:08:09.872Z"><meta property="article:author" content="Oikiou"><meta property="article:tag" content="pve"><meta property="article:tag" content="virtual"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.oikiou.top/2023/52f35219/bus-types-table.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>ProxmoxVE - Oikiou&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/custom.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"www.oikiou.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"bash"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"left",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:"G-TSV6137NWK",tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null},gtag:"G-TSV6137NWK",woyaola:null,cnzz:null},search_path:"/xml/local-search-database.xml",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Oikiou&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://bing.img.run/1920x1080.php) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="ProxmoxVE"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Oikiou </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-08-24 22:57" pubdate>2023年8月24日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 4.7k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 79 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="padding-left:2rem;margin-right:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">ProxmoxVE</h1><p id="updated-time" class="note note-info" style="display:none">本文最后更新于 2024-08-07T17:08:09+08:00</p><div class="markdown-body"><h1 id="ProxmoxVE"><a href="#ProxmoxVE" class="headerlink" title="ProxmoxVE"></a>ProxmoxVE</h1><h2 id="一些前置知识"><a href="#一些前置知识" class="headerlink" title="一些前置知识"></a>一些前置知识</h2><h3 id="qcow2-raw-vmdk-磁盘格式的区别"><a href="#qcow2-raw-vmdk-磁盘格式的区别" class="headerlink" title="qcow2 raw vmdk 磁盘格式的区别"></a>qcow2 raw vmdk 磁盘格式的区别</h3><p>KVM 虚拟化中使用的镜像格式通常为 RAW 和 QCOW2 两种格式.</p><blockquote><h2 id="RAW-img"><a href="#RAW-img" class="headerlink" title="RAW (img)"></a>RAW (img)</h2><p>RAW 的原意是「未被加工的」, 所以 RAW 格式镜像文件又被称为 <em>原始镜像</em> 或 <em>裸设备镜像</em>, 从这些称谓可以看出, RAW 格式镜像文件能够直接当作一个块设备, 以供 GuestOS 使用. 也就是说 KVM 的 GuestOS 可以直接从 RAW 镜像中启动, 就如 HostOS 直接从硬盘中启动一般.</p><ul><li>是一种裸设备格式，通常提供良好的性能。</li><li>简单且原生，易于使用和转换到其他格式。</li><li>支持直接挂载，可以作为文件系统使用。</li><li>不支持快照、压缩或加密等高级功能。</li><li>占用空间取决于实际使用的数据量，类似于物理磁盘。</li></ul><p><strong>块设备</strong>: IO 设备中的一类, 将信息存储在固定大小的块中, 并且每个块都有自己的地址, 常用的块设备有硬盘.</p><p><strong>因为 RAW 镜像文件赤裸裸的特性带来了下列好处:</strong></p><ul><li>使用 dd 指令创建一个 File 就能够模拟 RAW 镜像文件</li><li>性能较 QCOW2 要更高 (I&#x2F;O 效率更高25%左右)</li><li>支持裸设备的原生特性, 例如: 直接挂载</li><li>能够随意转换格式, 甚至作为其他两种格式转换时的中间格式</li><li>能够使用 dd 指令来追加 RAW 镜像文件的空间</li></ul><p><strong>相对的, RAW 镜像文件也具有一个非常大的缺陷, 就是不支持快照.</strong> 所以才有了后来 QCOW 和 QCOW2 的发展.</p><h2 id="QCOW2-QEMU-COW-2"><a href="#QCOW2-QEMU-COW-2" class="headerlink" title="QCOW2 (QEMU-COW 2)"></a>QCOW2 (QEMU-COW 2)</h2><p>(摘自官方文档)QEMU copy-on-write format with a range of special features, including the ability to take multiple snapshots, smaller images on filesystems that don’t support sparse files, optional AES encryption, and optional zlib compression<br>QEMU-COW 镜像文件具有一系列特性, 支持包括 <strong>多重快照</strong>(能够创建基于之前镜像的新镜像, 速度更快), <strong>占用更小的存储空间</strong>(不支持稀疏特性, 不会预先分配指定 Size 的存储空间), <strong>可选的 AES 加密方式</strong>, <strong>可选的 zlib 压缩方式</strong> 等功能.</p><p>QCOW2 镜像格式是 KVM-QEMU 支持的磁盘镜像格式之一, <strong>其表现形式为在一个系统文件中模拟一个具有一定 Size 的块设备.</strong></p><ul><li>支持快照功能，允许在不增加存储空间的前提下创建多个虚拟机状态的快照。</li><li>支持压缩，可以减少存储空间的使用。</li><li>支持加密，以保护虚拟机磁盘数据的安全性。</li><li>支持Copy-on-Write，只有当数据被修改时才会占用新的存储空间。</li><li>性能接近RAW格式，但提供了更多的高级功能。</li></ul><h2 id="VMDK-Virtual-Machine-Disk"><a href="#VMDK-Virtual-Machine-Disk" class="headerlink" title="VMDK (Virtual Machine Disk)"></a>VMDK (Virtual Machine Disk)</h2><ul><li>主要由VMware使用，支持多种VMware产品。</li><li>支持动态分配和固定大小的虚拟硬盘。</li><li>与VMware的虚拟化环境紧密集成，提供了良好的性能和稳定性。</li><li>支持快照功能，但与QCOW2的快照实现不同。</li><li>通常不用于非VMware环境，与其他虚拟化平台的兼容性有限。</li></ul></blockquote><h3 id="网卡怎么选-VirtIO-E1000-RTL8139"><a href="#网卡怎么选-VirtIO-E1000-RTL8139" class="headerlink" title="网卡怎么选 VirtIO E1000 RTL8139"></a>网卡怎么选 VirtIO E1000 RTL8139</h3><p>“<strong>RTL8139</strong>”（古董级别，性能较差，古老系统使用）速率可以达到100Mb&#x2F;s，这个网卡的兼容性最好。</p><blockquote><p>这个网卡模式是qemu-kvm默认的模拟网卡类型，RTL8139是Realtek半导体公司的一个10&#x2F;100M网卡系列，是曾经非常流行（当然现在看来有点古老）且兼容性好的网卡，几乎所有的现代操作系统都对RTL8139网卡驱动的提供支持。</p></blockquote><p>“<strong>E1000</strong>”（水桶选手，千兆速率，各项都很均衡）速率可以达到1Gb&#x2F;s，这个网卡的兼容性较好。</p><blockquote><p>提供Intel e1000系列的网卡模拟，纯的QEMU（非qemu-kvm）默认就是提供Intel e1000系列的虚拟网卡。</p><p>英特尔<code>e1000</code>甚至为相当古老和不知名的操作系统提供了驱动程序。但物理 e1000 网卡的硬件相当复杂，因此会因为需要对其进行仿真而产生一些开销。</p></blockquote><p>“<strong>VirtIO</strong>” （性能之王，兼容极差）速率可以达到10Gb&#x2F;s，这个网卡的兼容性最差，很多系统需要安装特定驱动才能使用。</p><blockquote><p>是支持半虚拟化IO（virtio）的设备。</p><p>如果您在虚拟机内运行的内容都支持<code>virtio</code>，它可能会为您提供最佳性能，因为它允许虚拟机跳过大多数相关步骤模拟虚拟网卡并控制虚拟硬件，主机利用实际物理网卡的硬件功能，最大限度地提高虚拟机流量的效益。</p><p>VirtIO windows的驱动文件可以在这里下载：<a target="_blank" rel="noopener" href="https://github.com/virtio-win/virtio-win-pkg-scripts">https://github.com/virtio-win/virtio-win-pkg-scripts</a></p><p><a target="_blank" rel="noopener" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/</a></p></blockquote><h3 id="硬盘接口怎么选-IDE-SATA-SCSI-VirtIO"><a href="#硬盘接口怎么选-IDE-SATA-SCSI-VirtIO" class="headerlink" title="硬盘接口怎么选 IDE SATA SCSI VirtIO"></a>硬盘接口怎么选 IDE SATA SCSI VirtIO</h3><p>IDE 速度最差，兼容性较好，比较古老的接口了</p><p>SATA 速度不错，兼容性也可以。</p><p>SCSI （通常称为VirtIO SCSI ）</p><p>VirtIO （通常称为VirtIO Block）</p><blockquote><p>一般来说，不鼓励使用<code>IDE</code>或 ，<code>SATA</code>因为它们相对较慢。在其最佳实践指南中，Proxmox 建议使用 VirtIO SCSI，即<code>SCSI</code>连接到<code>VirtIO SCSI</code>控制器的总线（在最新的 Proxmox 版本上默认选择）。这是假设您在具有快速磁盘阵列的服务器上运行 Proxmox，稍后会详细介绍。</p><p>使用<code>SCSI</code>或<code>VirtIO</code>。差异可以忽略不计，但两者都远远优于<code>SATA</code>。Proxmox 建议使用，<code>SCSI</code>因为它更新且维护得更好。</p><p><img src="/2023/52f35219/bus-types-table.png" srcset="/img/loading.gif" lazyload alt="img"></p><p><img src="/2023/52f35219/image-41.png" srcset="/img/loading.gif" lazyload alt="img"></p></blockquote><p>即local-lvm对应&#x2F;dev&#x2F;pve&#x2F;data，&#x2F;var&#x2F;lib&#x2F;vz&#x2F;template&#x2F;iso</p><p>默认存在local目录，对应&#x2F;var&#x2F;lib&#x2F;vz</p><h2 id="一些教程"><a href="#一些教程" class="headerlink" title="一些教程"></a>一些教程</h2><p>PVE 安装 <a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-8159418-1-1.html">https://www.right.com.cn/forum/thread-8159418-1-1.html</a></p><p>PVE 的群晖安装 <a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a8x84l27/">https://post.smzdm.com/p/a8x84l27/</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mokou/p/17042705.html">https://www.cnblogs.com/mokou/p/17042705.html</a></p><p><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/apv5xvk9/">https://post.smzdm.com/p/apv5xvk9/</a></p><p>群晖引导 <a target="_blank" rel="noopener" href="https://github.com/fbelavenuto/arpl">https://github.com/fbelavenuto/arpl</a></p><p><a target="_blank" rel="noopener" href="https://wp.gxnas.com/12245.html">https://wp.gxnas.com/12245.html</a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>准备工作</p><ul><li><p>确保符合安装软件的最低要求</p><blockquote><ul><li>CPU: 64bit (Intel EMT64 or AMD64)</li><li><a target="_blank" rel="noopener" href="https://pve.proxmox.com/wiki/FAQ#Supported_CPU_chips" title="FAQ">Intel VT&#x2F;AMD-V capable CPU</a>&#x2F;Mainboard for KVM full virtualization support</li><li>RAM: 1 GB RAM, plus additional RAM needed for guests</li><li>Hard drive with at least 16 GiB of space, plus additional space needed for guests</li><li>One network card (NIC)</li></ul></blockquote></li><li><p>下载PVE的ISO镜像<br><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/proxmox/iso/">https://mirrors.tuna.tsinghua.edu.cn/proxmox/iso/</a><br><a target="_blank" rel="noopener" href="https://www.proxmox.com/downloads">https://www.proxmox.com/downloads</a></p></li><li><p>准备一个u盘</p></li><li><p>将ISO写入u盘</p><ul><li>rufus</li><li>Win32DiskImager</li></ul></li><li><p>使电脑从u盘启动</p></li><li><p>重启设备，正式进入安装流程</p></li><li><p>这里有两种安装方式</p><ul><li>图形化界面安装 (Graphical)（首选，用户体验更佳，交互更简单）</li><li>终端UI界面安装 (Terminal UI)（备选，兼容性强，遇到非常新、非常旧的cpu，第一种方法无法使用的情况下就可以选用这种方式）</li></ul></li><li><p>硬盘格式</p><ul><li>这里有好几种硬盘格式可选。EXT4、XFS、ZFS 和 BTRFS。我只有一两个硬盘，数据相对不是特别的重要，就选默认的ext4了。<ul><li>几种格式的对比。<ul><li><a target="_blank" rel="noopener" href="https://forum.proxmox.com/threads/choose-between-ext4-xfs-zfs-and-btrfs-why.135128/">Choose between EXT4, XFS, ZFS and BTRFS ? Why ?</a></li><li><a target="_blank" rel="noopener" href="https://linux.cn/article-7083-1.html">如何选择文件系统：EXT4、Btrfs 和 XFS</a></li></ul></li></ul></li></ul></li><li><p>系统将会自动安装，安装后会自动重启</p></li><li><p><code>ping</code>对应地址，重启后不久正常通信后即可访问<code>pve ip:8006</code>进入管理界面</p></li><li><p>重启后，PVE显示器也会提示管理地址。</p></li><li><p>至此安装结束</p></li><li><p>推荐安装完成后再安装上一个PVETools。参考下文。</p></li></ul><h1 id="Cmd"><a href="#Cmd" class="headerlink" title="Cmd"></a>Cmd</h1><h2 id="虚拟机-操作指令"><a href="#虚拟机-操作指令" class="headerlink" title="虚拟机 操作指令"></a>虚拟机 操作指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">取得虚拟机当前状态</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">pvesh get /nodes/&lt;节点<span class="hljs-built_in">id</span>&gt;/qemu/&lt;虚拟机<span class="hljs-built_in">id</span>&gt;/status/current</span><br>pvesh get /nodes/pve/qemu/107/status/current<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">关闭虚拟机</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">pvesh create /nodes/&lt;节点<span class="hljs-built_in">id</span>&gt;/qemu/&lt;虚拟机<span class="hljs-built_in">id</span>&gt;/status/stop</span><br>pvesh create /nodes/pve/qemu/107/status/stop<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">启动虚拟机</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">pvesh create /nodes/&lt;节点<span class="hljs-built_in">id</span>&gt;/qemu/&lt;虚拟机<span class="hljs-built_in">id</span>&gt;/status/start</span><br>pvesh create /nodes/pve/qemu/107/status/start<br><br><br><br><br><br>qm &lt;命令&gt; &lt;vmid&gt; [选项]<br>qm [create|set] &lt;vmid&gt;  # 创建虚拟机<br>    --memory  &lt;MBYTES&gt;    memory in MB (64 - 8192)<br>    --sockets &lt;N&gt;         set number of CPU sockets &lt;N&gt;<br>    --cores &lt;N&gt;           set cores per socket to &lt;N&gt;<br>    --ostype NAME         specify OS type<br>    --onboot [yes|no]     start at boot<br>    --keyboard XX         set vnc keyboard layout<br>    --cpuunits &lt;num&gt;      CPU weight for a VM<br>    --name &lt;text&gt;         set a name for the VM<br>    --description &lt;text&gt;  set VM description<br>    --boot [a|c|d|n]      specify boot order<br>    --bootdisk &lt;disk&gt;     enable booting from &lt;disk&gt;<br>    --acpi (yes|no)       enable/disable ACPI<br>    --kvm (yes|no)        enable/disable KVM<br>    --tdf (yes|no)        enable/disable time drift fix<br>    --localtime (yes|no)  set the RTC to local time<br>    --vga (gd5446|vesa)   specify VGA type<br>    --vlan[0-9u]          MODEL=XX:XX:XX:XX:XX:XX[,MODEL=YY:YY:YY:YY:YY:YY]<br>    --ide&lt;N&gt;              [volume=]volume,[,media=cdrom|disk]<br>                          [,cyls=c,heads=h,secs=s[,trans=t]]<br>                          [,cache=none|writethrough|writeback]<br>                          [,snapshot=on|off][,cache=on|off][,format=f]<br>                          [,werror=enospc|ignore|report|stop]<br>                          [,rerror=ignore|report|stop]<br>                          [,backup=no|yes]<br>    --ide&lt;N&gt; &lt;GBYTES&gt;     create new disk<br>    --ide&lt;N&gt; delete       remove drive - destroy image<br>    --ide&lt;N&gt; undef        remove drive - keep image<br>    --cdrom &lt;file&gt;        is an alias for --ide2 &lt;file&gt;,media=cdrom<br>    --scsi&lt;N&gt;             [volume=]volume,[,media=cdrom|disk]<br>                          [,cyls=c,heads=h,secs=s[,trans=t]]<br>                          [,snapshot=on|off][,format=f]<br>                          [,cache=none|writethrough|writeback]<br>                          [,werror=enospc|ignore|report|stop]<br>                          [,backup=no|yes]<br>    --scsi&lt;N&gt; &lt;GBYTES&gt;    create new disk<br>    --scsi&lt;N&gt; delete      remove drive - destroy image<br>    --scsi&lt;N&gt; undef       remove drive - keep image<br>    --virtio&lt;N&gt;           [volume=]volume,[,media=cdrom|disk]<br>                          [,cyls=c,heads=h,secs=s[,trans=t]]<br>                          [,snapshot=on|off][,format=f]<br>                          [,cache=none|writethrough|writeback]<br>                          [,werror=enospc|ignore|report|stop]<br>                          [,rerror=ignore|report|stop]<br>                          [,backup=no|yes]<br>    --virtio&lt;N&gt; &lt;GBYTES&gt;  create new disk<br>    --virtio&lt;N&gt; delete    remove drive - destroy image<br>    --virtio&lt;N&gt; undef     remove drive - keep image<br>    <br>qm monitor &lt;vmid&gt;         # 连接到虚拟机控制监视器<br>qm start &lt;vmid&gt;               # 启动实例<br>qm shutdown &lt;vmid&gt;      # 优雅停止实例 发送关机命令<br>qm wait &lt;vmid&gt; [time]   wait until vm is stopped<br>qm stop &lt;vmid&gt;               # 停止实例 强制停止<br>qm reset &lt;vmid&gt;              # 重启实例 相当于stop然后再start<br>qm suspend &lt;vmid&gt;        # 暂停实例<br>qm resume &lt;vmid&gt;         # 恢复实例<br>qm cad &lt;vmid&gt;               #发送按键 ctrl-alt-delete<br>qm destroy &lt;vmid&gt;        # 销毁实例（删除所有已使用/拥有的卷）<br>qm unlock &lt;vmid&gt;         # 清除迁移/备份锁<br>qm status &lt;vmid&gt;          # 显示实例状态<br>qm cdrom &lt;vmid&gt; [&lt;device&gt;] &lt;path&gt;  set cdrom path. &lt;device is ide2 by default&gt;<br>qm cdrom &lt;vmid&gt; [&lt;device&gt;] eject   eject cdrom<br>qm unlink &lt;vmid&gt; &lt;volume&gt;  delete unused disk images<br>qm vncproxy &lt;vmid&gt; &lt;ticket&gt;  open vnc proxy<br>qm vnc &lt;vmid&gt;           start (X11) vncviewer (experimental)<br>qm showcmd &lt;vmid&gt;     # 显示命令行（调试信息）<br>qm list                             # 列出所有虚拟机<br>qm startall                       # 启动所有虚拟机 当onboot=1时<br>qm stopall [timeout]       # 停止所有虚拟机（默认超时为3分钟）<br></code></pre></td></tr></table></figure><h2 id="集群-操作指令"><a href="#集群-操作指令" class="headerlink" title="集群 操作指令"></a>集群 操作指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看集群资源状况</span><br>pvesh get /cluster/resources<br><br><br><br>pvesr list			# 列出存储复制作业<br>ha-manager status   # 查看HA状态<br>pvecm nodes    		# 查看集群节点<br>pvecm status    	# 查看集群状态<br>pveperf<br>pve-firewall compile  	# 查看防火墙规则<br>pve-firewall localnet  	# 输出本地网络信息<br>pve-firewall restart    # 重启防火墙<br>pve-firewall stop      	# 停止防火墙<br>pve-firewall start      # 启动防火墙<br><br><br><br></code></pre></td></tr></table></figure><h1 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h1><h2 id="PVE-Tools-的安装"><a href="#PVE-Tools-的安装" class="headerlink" title="PVE Tools 的安装"></a>PVE Tools 的安装</h2><p>Github地址：<a target="_blank" rel="noopener" href="https://github.com/ivanhao/pvetools">https://github.com/ivanhao/pvetools</a></p><h2 id="安装软件出现-401-Unauthorized"><a href="#安装软件出现-401-Unauthorized" class="headerlink" title="安装软件出现 401  Unauthorized"></a>安装软件出现 401 Unauthorized</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">E: Failed to fetch https:<span class="hljs-regexp">//</span>enterprise.proxmox.com<span class="hljs-regexp">/debian/</span>pve<span class="hljs-regexp">/dists/</span>buster/InRelease  <span class="hljs-number">401</span>  Unauthorized [IP: <span class="hljs-number">212.224</span>.<span class="hljs-number">123.70</span> <span class="hljs-number">443</span>]<br></code></pre></td></tr></table></figure><ul><li>在pve管理界面内，更新，存储库<ul><li>将带<code>enterprise</code>字样的库禁用。</li></ul></li></ul><h2 id="apt-update-订阅库不可用的问题"><a href="#apt-update-订阅库不可用的问题" class="headerlink" title="apt update 订阅库不可用的问题"></a>apt update 订阅库不可用的问题</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Err:5 https://enterprise.proxmox.com/debian/ceph-quincy bookworm InRelease  401  Unauthorized [IP: 51.79.228.122 443]<br>Hit:6 http://security.debian.org bookworm-security InRelease<br>Reading package lists... Done<br>E: Failed to fetch https://enterprise.proxmox.com/debian/ceph-quincy/dists/bookworm/InRelease  401  Unauthorized [IP: 51.79.228.122 443]<br>E: The repository &#x27;https://enterprise.proxmox.com/debian/ceph-quincy bookworm In Release&#x27; is not signed.<br>N: Updating from such a repository can&#x27;t be done securely, and is therefore disa bled by default.<br>N: See apt-secure(8) manpage for repository creation and user configuration details.<br></code></pre></td></tr></table></figure><p>The <strong>apt</strong> package manager on the fresh Proxmox host is configured to download packages from <strong>Enterprise Repository</strong> by default. You must have a paid subscription to use this repo. If you don’t have paid subscription you should switch to <strong>No-Subscription Repository</strong>.</p><blockquote><p>新 Proxmox 主机上的 <strong>apt</strong> 包管理器默认配置为从 <strong>Enterprise Repository 企业存储库</strong> 下载包。 您必须付费订阅才能使用此存储库。 如果您没有付费订阅，您应该切换到<strong>No-Subscription Repository 无订阅存储库</strong>。</p></blockquote><p>Either delete <code>/etc/apt/sources.list.d/pve-enterprise.list</code> file or comment all lines in this file with <code>#</code>.</p><p>Create new file <code>/etc/apt/sources.list.d/pve-no-subscription.list</code> with content:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">deb http://download.proxmox.com/debian/pve buster pve-no-subscription<br><br><span class="hljs-comment"># PVE 8.0</span><br>deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription<br><span class="hljs-comment"># 镜像源</span><br>deb http://mirrors.ustc.edu.cn/proxmox/debian/pve/ bookworm pve-no-subscription<br></code></pre></td></tr></table></figure><h2 id="apt-update-的时候-NO-PUBKEY-问题"><a href="#apt-update-的时候-NO-PUBKEY-问题" class="headerlink" title="apt update 的时候 NO_PUBKEY 问题"></a>apt update 的时候 NO_PUBKEY 问题</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">The following signatures couldn&#x27;t be verified because the public key is not available: NO_PUBKEY 7BF2812E8A6E88E0<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shel">apt-get install gnupg2 -y<br>wget http://download.proxmox.com/debian/key.asc <br>apt-key add key.asc<br></code></pre></td></tr></table></figure><h2 id="修改PVE的管理地址"><a href="#修改PVE的管理地址" class="headerlink" title="修改PVE的管理地址"></a>修改PVE的管理地址</h2><h3 id="无法进入web管理界面"><a href="#无法进入web管理界面" class="headerlink" title="无法进入web管理界面"></a>无法进入web管理界面</h3><ol><li><p>编辑 interface 文件</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">vi /etc/network/<span class="hljs-built_in">int</span>erfaces<br></code></pre></td></tr></table></figure><p>通过键盘上下左右移动到address这行的IP地址，按一次i进入修改状态，修改为新的IP地址，如果需要网关则修改gateway这行，修改完成确认无误后按一次ESC键输入“:wq”回车保存退出。</p></li><li><p>修改显示</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/i</span>ssue<br></code></pre></td></tr></table></figure><p>通过键盘上下左右移动到https:&#x2F;&#x2F;这行的IP地址，按一次i进入修改状态，修改为新的IP地址，端口8006不要改，修改完成确认无误后按一次ESC键输入“:wq”回车保存退出。</p></li><li><p>修改 hosts 文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>hosts<br></code></pre></td></tr></table></figure><p>通过键盘上下左右移动到第2行的IP地址，按一次i进入修改状态，修改为新的IP地址，修改完成确认无误后按一次ESC键输入“:wq”回车保存退出。</p></li><li><p><strong>reboot</strong>，重启PVE！</p></li></ol><h3 id="可以进入web管理界面"><a href="#可以进入web管理界面" class="headerlink" title="可以进入web管理界面"></a>可以进入web管理界面</h3><p>如果是PVE版本大于等于6.1，则可以使用web管理页面的网络选项菜单中修改vmbr0的IP，修改完成后，点击应用配置生效即可。此操作无需重启服务器即可应用新IP。</p><p><img src="/2023/52f35219/2983653-20221011173336293-1137047342.png" srcset="/img/loading.gif" lazyload alt="img"></p><p>修改显示的访问的链接地址。<br>重启后的提示语还是显示原来的https:&#x2F;&#x2F;旧IP:8006。这个要是以后忘了就容易出问题。可以更改&#x2F;etc&#x2F;hosts文件，也可以在web管理页面主机处修改，修改完记得保存。此操作修改完需要重启才可刷新显示提示语。</p><p><img src="/2023/52f35219/2983653-20221011173352327-326543372.png" srcset="/img/loading.gif" lazyload alt="img"></p><h2 id="PVE-导入img磁盘文件-qm-importovf-qm-importovf"><a href="#PVE-导入img磁盘文件-qm-importovf-qm-importovf" class="headerlink" title="PVE 导入img磁盘文件 qm importovf qm importovf"></a>PVE 导入img磁盘文件 qm importovf qm importovf</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Create a new VM using parameters <span class="hljs-built_in">read</span> from an OVF manifest</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">An <span class="hljs-built_in">alias</span> <span class="hljs-keyword">for</span> qm disk import.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">          &lt;虚拟机ID&gt; &lt;清单&gt;      &lt;存储&gt; [选项]</span><br>qm importovf &lt;vmid&gt; &lt;manifest&gt; &lt;storage&gt; [OPTIONS]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">示例</span><br>qm importdisk 102 /var/lib/vz/template/iso/openwrt.img local-lvm<br></code></pre></td></tr></table></figure><h2 id="qemu-img-img转换为qcow2"><a href="#qemu-img-img转换为qcow2" class="headerlink" title="qemu-img img转换为qcow2"></a>qemu-img img转换为qcow2</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">转换</span><br>qemu-img convert -f raw -O qcow2 file.img tofile.qcow2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">导入</span><br>qm importdisk 101 xxxfile.qcow2 local-lvm<br></code></pre></td></tr></table></figure><h2 id="pvetools工具安装省电后无法睿频"><a href="#pvetools工具安装省电后无法睿频" class="headerlink" title="pvetools工具安装省电后无法睿频"></a>pvetools工具安装省电后无法睿频</h2><h2 id="自动调整运行频率"><a href="#自动调整运行频率" class="headerlink" title="自动调整运行频率"></a>自动调整运行频率</h2><p>网上有很多教程会修改<code>vi /etc/default/grub</code>文件，将<code>driver</code>改成<code>acpi-cpufreq</code>。</p><p>我的CPU是J4125，在<code>intel_cpufreq</code>下也可以使用<code>conservative ondemand userspace powersave performance schedutil</code>这些模式。所有就没有去修改。</p><p><a target="_blank" rel="noopener" href="https://blog.51cto.com/picker/5020502">参考</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装</span><br>apt-get install cpufrequtils<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看cpu当前信息</span><br>cpufreq-info<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看可以使用的模式</span><br>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors<br><span class="hljs-meta prompt_"># </span><span class="language-bash">例如J4125这里会输出  conservative ondemand userspace powersave performance schedutil</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看当前运行的模式</span><br>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor<br></code></pre></td></tr></table></figure><p>cpu运行自动配置文件<code>/etc/init.d/cpufrequtils</code></p><ul><li>这个文件在开机的时候会自动调用，自动运行<ul><li>这个文件主要的内容就是运行<code>cpufreq-set</code>指令调整运行模式和频率</li><li>这个文件会优先读取和使用<code>/etc/default/cpufrequtils</code>文件的内容</li></ul></li><li>编辑这个文件<code>vi /etc/init.d/cpufrequtils</code><ul><li>修改频率 模式 保存</li></ul></li><li>重启</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## BEGIN INIT INFO</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Provides:       cpufrequtils</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Required-Start: <span class="hljs-variable">$remote_fs</span> loadcpufreq</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Required-Stop:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Default-Start:  2 3 4 5</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Default-Stop:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Short-Description: <span class="hljs-built_in">set</span> CPUFreq kernel parameters</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Description: utilities to deal with CPUFreq Linux</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">      kernel support</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## END INIT INFO</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"></span><br>DESC=&quot;CPUFreq Utilities&quot;<br><br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br>CPUFREQ_SET=/usr/bin/cpufreq-set<br>CPUFREQ_INFO=/usr/bin/cpufreq-info<br>CPUFREQ_OPTIONS=&quot;&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">use lsb-base</span><br>. /lib/lsb/init-functions<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Which governor to use. Must be one of the governors listed <span class="hljs-keyword">in</span>:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  <span class="hljs-built_in">cat</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># and which limits to set. Both MIN_SPEED and MAX_SPEED must be values</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">listed <span class="hljs-keyword">in</span>:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  <span class="hljs-built_in">cat</span> /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">a value of 0 <span class="hljs-keyword">for</span> any of the two variables will disabling the use of</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">that <span class="hljs-built_in">limit</span> variable.</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># WARNING: the correct kernel module must already be loaded or compiled in.</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># Set ENABLE to &quot;true&quot; to let the script run at boot time.</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># eg:   ENABLE=&quot;true&quot;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">      GOVERNOR=<span class="hljs-string">&quot;ondemand&quot;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">      MAX_SPEED=1000</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">      MIN_SPEED=500</span><br><br>ENABLE=&quot;true&quot;<br>GOVERNOR=&quot;ondemand&quot;<br>MAX_SPEED=&quot;0&quot;<br>MIN_SPEED=&quot;0&quot;<br><br>check_governor_avail() &#123;<br>        info=&quot;/sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors&quot;<br>        if [ -f $info ] &amp;&amp; grep -q &quot;\&lt;$GOVERNOR\&gt;&quot; $info ; then<br>                return 0;<br>        fi<br>        return 1;<br>&#125;<br><br>[ -x $CPUFREQ_SET ] || exit 0<br><br>if [ -f /etc/default/cpufrequtils ] ; then<br>        . /etc/default/cpufrequtils<br>fi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">if</span> not enabled <span class="hljs-keyword">then</span> <span class="hljs-built_in">exit</span> gracefully</span><br>[ &quot;$ENABLE&quot; = &quot;true&quot; ] || exit 0<br><br>if [ -n &quot;$MAX_SPEED&quot; ] &amp;&amp; [ $MAX_SPEED != &quot;0&quot; ] ; then<br>        CPUFREQ_OPTIONS=&quot;$CPUFREQ_OPTIONS --max $MAX_SPEED&quot;<br>fi<br><br>if [ -n &quot;$MIN_SPEED&quot; ] &amp;&amp; [ $MIN_SPEED != &quot;0&quot; ] ; then<br>        CPUFREQ_OPTIONS=&quot;$CPUFREQ_OPTIONS --min $MIN_SPEED&quot;<br>fi<br><br>if [ -n &quot;$GOVERNOR&quot; ] ; then<br>        CPUFREQ_OPTIONS=&quot;$CPUFREQ_OPTIONS --governor $GOVERNOR&quot;<br>fi<br><br>CPUS=$(cat /proc/stat|sed -ne &#x27;s/^cpu\([[:digit:]]\+\).*/\1/p&#x27;)<br>RETVAL=0<br>case &quot;$1&quot; in<br>        start|force-reload|restart|reload)<br>                log_action_begin_msg &quot;$DESC: Setting $GOVERNOR CPUFreq governor&quot;<br>                if check_governor_avail ; then<br>                        for cpu in $CPUS ; do<br>                                log_action_cont_msg &quot;CPU$&#123;cpu&#125;&quot;<br>                                $CPUFREQ_SET --cpu $cpu $CPUFREQ_OPTIONS 2&gt;&amp;1 &gt; /dev/null || \<br>                                        RETVAL=$?<br>                        done<br>                        log_action_end_msg $RETVAL &quot;&quot;<br>                else<br>                        log_action_cont_msg &quot;disabled, governor not available&quot;<br>                        log_action_end_msg $RETVAL<br>                fi<br>                ;;<br>        stop)<br>                ;;<br>        *)<br>                echo &quot;Usage: $0 &#123;start|stop|restart|reload|force-reload&#125;&quot;<br>                exit 1<br>esac<br><br>exit 0<br></code></pre></td></tr></table></figure><h2 id="pve-合并local-lvm和local分区"><a href="#pve-合并local-lvm和local分区" class="headerlink" title="pve 合并local-lvm和local分区"></a>pve 合并local-lvm和local分区</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52960369/article/details/135450871">参考</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">lsblk 查看一下分区结构</span> <br>lsblk<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">备份一下 虚拟机的磁盘文件。。。 这一步我没做。。。。。 悲剧了</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除 local-lvm 千万注意备份一下 pve/data/ 目录下的 disk 虚拟磁盘文件 PVE8.2.2我照着这么操作直接把磁盘文件给删掉了，我人都傻了。。。。。</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">后面几个就是在删除磁盘文件</span><br>lvremove pve/data<br>Removing pool pve/data will remove 3 dependent volume(s). Proceed? [y/n]: y<br>Do you really want to remove active logical volume pve/vm-220-disk-0? [y/n]: y<br>  Logical volume &quot;vm-220-disk-0&quot; successfully removed.<br>Do you really want to remove active logical volume pve/vm-300-disk-0? [y/n]: y<br>  Logical volume &quot;vm-300-disk-0&quot; successfully removed.<br>Do you really want to remove active logical volume pve/vm-220-disk-1? [y/n]: y<br>  Logical volume &quot;vm-220-disk-1&quot; successfully removed.<br>Do you really want to remove active logical volume pve/data? [y/n]: y<br>  Logical volume &quot;data&quot; successfully removed.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">扩展<span class="hljs-built_in">local</span></span><br>lvextend -l +100%FREE -r pve/root<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看状态</span><br>lsblk<br></code></pre></td></tr></table></figure><p>在管理页面删除local-LVM<br><img src="/ProxmoxVE.assets/image-20240626174453544.png" srcset="/img/loading.gif" lazyload></p><p>修改 local 的属性将local-lvm的功能加上去。</p><h2 id="安装群晖"><a href="#安装群晖" class="headerlink" title="安装群晖"></a>安装群晖</h2><p><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a2036n3n/">参考</a></p><ul><li>创建虚拟机<ul><li>操作系统<ul><li>不需要使用介质</li></ul></li><li>系统<ul><li>机型，这里大部分教程推荐使用 <code>q35</code><ul><li><code>q35</code>比默认的<code>i440fx</code>机型更新，性能更好</li><li>也有人说<code>i440fx</code>兼容性更好，有些小bug在<code>i440fx</code>上不会出现。</li></ul></li><li>其他默认即可</li></ul></li><li>磁盘<ul><li>这里需要注意群晖只支持<code>sata</code>，无法支持性能更强的<code>scsi</code>。</li><li>后面将引导转换为磁盘的时候也需要注意接口要是<code>sata</code>的。</li></ul></li><li>CPU<ul><li>类型<ul><li>host 代表使用和主机一样的CPU信息和架构（通用性差，性能更优）</li></ul></li></ul></li><li>内存</li><li>网络<ul><li>网络这里有些引导不支持<code>VirtlO</code>，就要要改为<code>E1000</code></li></ul></li></ul></li><li>添加引导<ul><li>将引导<code>*.img</code>文件上传到PVE内</li><li>使用 <code>qm importdisk</code> 指令导入img文件用作磁盘<ul><li><a href="#PVE%20%E5%AF%BC%E5%85%A5img%E7%A3%81%E7%9B%98%E6%96%87%E4%BB%B6%20qm%20importovf%20qm%20importovf">PVE 导入img磁盘文件 qm importovf qm importovf</a></li></ul></li><li>将虚拟机内<code>未使用</code>的磁盘改为<code>sata</code>接口，并添加到虚拟机内</li></ul></li><li>硬盘直通<ul><li>。。。。。</li></ul></li><li></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">args: -device &#x27;qemu-xhci,addr=0x18&#x27; -drive &#x27;id=synoboot,file=/root/synoboot.img,if=none,format=raw&#x27; -device &#x27;usb-storage,id=synoboot,drive=synoboot,bootindex=1&#x27;<br></code></pre></td></tr></table></figure><p>关闭虚拟机，编辑虚拟机配置文件 &#x2F;etc&#x2F;pve&#x2F;qemu-server&#x2F;100.conf ，100是对应虚拟机ID，在顶部添加大佬的这一段代码，img路径改成对应的路径。改完后WebUI没有显示的，禁用掉其他启动项，直接启动虚拟机即可</p><h2 id="硬盘直通"><a href="#硬盘直通" class="headerlink" title="硬盘直通"></a>硬盘直通</h2><p>参考资料：<br><a target="_blank" rel="noopener" href="https://foxi.buduanwang.vip/virtualization/1754.html/">Proxmox VE pve硬盘直通</a></p><p>PVE的直通分为两种</p><ul><li>直通控制器（sata控制器、nvme控制器）<ul><li>接近裸机性能，损耗非常低</li><li>是一个物理磁盘，虚拟机可以获取真实硬盘信息，具有smart属性。</li><li>磁盘由虚拟机管理，虚拟机可以获取磁盘控制权</li><li><strong>要求PVE系统不能安装在控制器下属磁盘内</strong></li></ul></li><li>直通单个硬盘或者分区<ul><li>CPU性能越好，越接近裸机性能，损耗较低</li><li>硬盘会在虚拟机内会认为是一个qemu-hdd</li><li>磁盘由PVE管理</li><li>限制<ul><li>sata最大6个</li><li>ide最大3个</li><li>scsi最大128个</li><li>virtio-blk最大32个</li></ul></li></ul></li></ul><p><strong>列出当前的所有磁盘</strong><br>我们可以通过下面命令，列出当前的硬盘列表</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -la /dev/disk/by-id/|grep -v dm|grep -v lvm|grep -v part<br></code></pre></td></tr></table></figure><p>nvme开头的是nvme硬盘，ata开头是走sata或者ata通道的设备。scsi是scsi设备-阵列卡raid或者是直通卡上的硬盘。</p><h3 id="直通单个硬盘-分区"><a href="#直通单个硬盘-分区" class="headerlink" title="直通单个硬盘&amp;分区"></a>直通单个硬盘&amp;分区</h3><p>我们可以通过<code>qm set &lt;vmid&gt; --scsi[n] /dev/disk/by-id/xxxxxxx</code> 进行直通。<code>qm set &lt;vmid&gt; --delete scsi[n]</code>来取消直通。<br>vmid指的是虚拟机ID；–scsi[n]指的是接口（同样的还有scsi、sata、ide、virtio），n指的是端口号；&#x2F;dev….指的是需要直通的硬盘&amp;分区路径</p><p>实例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">qm set 220 --sata1 /dev/disk/by-id/ata-Netac_SSD_512GB_AA20230802512G645320<br><br>qm set 101 --scsi1 /dev/disk/by-id/nvme-INTEL_SSDPE2KX020T8_BTLJ039307142P0BGN<br><br></code></pre></td></tr></table></figure><p>建议为scsi设备，这样性能理论上是最优秀的。</p><p><code>qm help set</code> 可以获取帮助信息。</p><h3 id="直通控制器"><a href="#直通控制器" class="headerlink" title="直通控制器"></a>直通控制器</h3><p>磁盘控制器直通之后，虚拟机可以获得全部的磁盘属性。</p><p>需要注意的是，你需要多个磁盘控制器，且Proxmox VE系统安装在非需要直通的硬盘控制器上，否则会将系统直通给虚拟机，导致系统崩溃。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看PCI控制器</span><br>lspci<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看硬盘分布情况</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">有pve-root的，便是pve所在的硬盘</span><br>lsblk<br><br>ls -la /sys/dev/block/|grep -v loop |grep -v dm<br></code></pre></td></tr></table></figure><p>需要按照这个教程开启硬件直通功能<br><a target="_blank" rel="noopener" href="https://foxi.buduanwang.vip/virtualization/pve/561.html/">https://foxi.buduanwang.vip/virtualization/pve/561.html/</a></p><p>开启后在控制面板直接添加PCI设备即可。<br><img src="/2023/52f35219/image-20240729150809676.png" srcset="/img/loading.gif" lazyload><br><img src="/2023/52f35219/image-20240729150802776.png" srcset="/img/loading.gif" lazyload></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/tools/" class="category-chain-item">tools</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/pve/" class="print-no-link">#pve</a> <a href="/tags/virtual/" class="print-no-link">#virtual</a></div></div><div class="license-box my-3"><div class="license-title"><div>ProxmoxVE</div><div>https://www.oikiou.top/2023/52f35219/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Oikiou</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年8月24日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-cc-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-cc-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/96364bb6/" title="踩坑记 BSS段的初始化"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">踩坑记 BSS段的初始化</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/2f4ac7e2/" title="AUTOSAR"><span class="hidden-mobile">AUTOSAR</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="twikoo"></div><script type="text/javascript">Fluid.utils.loadComments("#comments",function(){Fluid.utils.createScript("https://lib.baomitu.com/twikoo/1.6.10/twikoo.all.min.js",function(){var o=Object.assign({envId:"https://twikoo.oikiou.top/",region:"ap-shanghai",path:"window.location.pathname"},{el:"#twikoo",path:"window.location.pathname",onCommentLoaded:function(){Fluid.utils.listenDOMLoaded(function(){var o="#twikoo .tk-content img:not(.tk-owo-emotion)";Fluid.plugins.imageCaption(o),Fluid.plugins.fancyBox(o)})}});twikoo.init(o)})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-left:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="tools" id="heading-4a931512ce65bdc9ca6808adf92d8783" role="tab" data-toggle="collapse" href="#collapse-4a931512ce65bdc9ca6808adf92d8783" aria-expanded="true">tools <span class="list-group-count">(24)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-4a931512ce65bdc9ca6808adf92d8783" role="tabpanel" aria-labelledby="heading-4a931512ce65bdc9ca6808adf92d8783"><div class="category-post-list"><a href="/2020/5ced0506/" title="DSlogic协议开发笔记" class="list-group-item list-group-item-action"><span class="category-post">DSlogic协议开发笔记</span> </a><a href="/2020/4ade0b2f/" title="SourceInsigh中Qicker的使用" class="list-group-item list-group-item-action"><span class="category-post">SourceInsigh中Qicker的使用</span> </a><a href="/2021/69c3279c/" title="Git" class="list-group-item list-group-item-action"><span class="category-post">Git</span> </a><a href="/2021/9be43835/" title="VSCode" class="list-group-item list-group-item-action"><span class="category-post">VSCode</span> </a><a href="/2021/18d811b/" title="J-Link RTT的使用方法" class="list-group-item list-group-item-action"><span class="category-post">J-Link RTT的使用方法</span> </a><a href="/2021/30f8332a/" title="手动添加JLink不支持的芯片" class="list-group-item list-group-item-action"><span class="category-post">手动添加JLink不支持的芯片</span> </a><a href="/2021/9f39ed86/" title="VSCode多行编辑被占用" class="list-group-item list-group-item-action"><span class="category-post">VSCode多行编辑被占用</span> </a><a href="/2022/aa858de8/" title="Wordpress" class="list-group-item list-group-item-action"><span class="category-post">Wordpress</span> </a><a href="/2022/a8b000ae/" title="RDPWrap" class="list-group-item list-group-item-action"><span class="category-post">RDPWrap</span> </a><a href="/2022/f5f9fa9b/" title="Docker" class="list-group-item list-group-item-action"><span class="category-post">Docker</span> </a><a href="/2022/1d3ed0f3/" title="VScode插件CommentTranslate在WSL内无效" class="list-group-item list-group-item-action"><span class="category-post">VScode插件CommentTranslate在WSL内无效</span> </a><a href="/2022/c6d84d87/" title="Hyper-V" class="list-group-item list-group-item-action"><span class="category-post">Hyper-V</span> </a><a href="/2022/f96c3c41/" title="静态网页 静态博客" class="list-group-item list-group-item-action"><span class="category-post">静态网页 静态博客</span> </a><a href="/2022/fd90dc4c/" title="使用Jlink 烧写SPI Flash存储芯片" class="list-group-item list-group-item-action"><span class="category-post">使用Jlink 烧写SPI Flash存储芯片</span> </a><a href="/2022/471570a6/" title="SpaceDesk手机用作电脑屏幕" class="list-group-item list-group-item-action"><span class="category-post">SpaceDesk手机用作电脑屏幕</span> </a><a href="/2022/9d389561/" title="Tmux 终端复用器(Terminal Multiplexer)" class="list-group-item list-group-item-action"><span class="category-post">Tmux 终端复用器(Terminal Multiplexer)</span> </a><a href="/2022/6fb71d96/" title="单位换算" class="list-group-item list-group-item-action"><span class="category-post">单位换算</span> </a><a href="/2022/a2c49dae/" title="PowerShell" class="list-group-item list-group-item-action"><span class="category-post">PowerShell</span> </a><a href="/2023/efa34a49/" title="speedtest.net 测速" class="list-group-item list-group-item-action"><span class="category-post">speedtest.net 测速</span> </a><a href="/2023/3c5e47f1/" title="CMake的使用" class="list-group-item list-group-item-action"><span class="category-post">CMake的使用</span> </a><a href="/categories/tools/" class="list-group-item list-group-item-action"><span class="category-post">More...</span></a></div></div></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><span>如果你有任何反馈请联系oikiou@outlook.com</span></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script>var relativeDate=function(){var t,e,i,n,m=document.getElementById("updated-time");m&&(e=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/,(i=(t=m.textContent).match(e))&&(n=moment(i[0]).fromNow(),m.textContent=t.replace(e,n)),m.style.display="")};Fluid.utils.createScript("https://lib.baomitu.com/moment.js/2.29.4/moment.min.js",function(){"zh-cn".startsWith("en")?relativeDate():Fluid.utils.createScript("https://lib.baomitu.com/moment.js/2.29.4/locale/zh-cn.min.js",function(){relativeDate()})})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/custom.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>